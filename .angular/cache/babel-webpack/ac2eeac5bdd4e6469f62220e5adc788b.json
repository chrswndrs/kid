{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/tree_view/ui.tree_view.base.js)\r\n * Version: 21.2.4\r\n * Build date: Mon Dec 06 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { getHeight } from \"../../core/utils/size\";\nimport $ from \"../../core/renderer\";\nimport domAdapter from \"../../core/dom_adapter\";\nimport eventsEngine from \"../../events/core/events_engine\";\nimport messageLocalization from \"../../localization/message\";\nimport { name as clickEventName } from \"../../events/click\";\nimport { asyncNoop, noop } from \"../../core/utils/common\";\nimport { hasWindow } from \"../../core/utils/window\";\nimport { isDefined, isPrimitive, isFunction, isString } from \"../../core/utils/type\";\nimport { extend } from \"../../core/utils/extend\";\nimport { each } from \"../../core/utils/iterator\";\nimport { getPublicElement } from \"../../core/element\";\nimport CheckBox from \"../check_box\";\nimport HierarchicalCollectionWidget from \"../hierarchical_collection/ui.hierarchical_collection_widget\";\nimport { addNamespace } from \"../../events/utils/index\";\nimport pointerEvents from \"../../events/pointer\";\nimport { name as dblclickEvent } from \"../../events/double_click\";\nimport fx from \"../../animation/fx\";\nimport Scrollable from \"../scroll_view/ui.scrollable\";\nimport LoadIndicator from \"../load_indicator\";\nimport { fromPromise, Deferred, when } from \"../../core/utils/deferred\";\nimport errors from \"../widget/ui.errors\";\nimport { nativeScrolling } from \"../../core/utils/support\";\nimport { getRelativeOffset } from \"../../renovation/ui/scroll_view/utils/get_relative_offset\";\nimport { SCROLLABLE_CONTENT_CLASS, DIRECTION_HORIZONTAL, DIRECTION_VERTICAL } from \"../../renovation/ui/scroll_view/common/consts\";\nvar WIDGET_CLASS = \"dx-treeview\";\nvar NODE_CLASS = \"\".concat(WIDGET_CLASS, \"-node\");\nvar NODE_CONTAINER_CLASS = \"\".concat(NODE_CLASS, \"-container\");\nvar NODE_LOAD_INDICATOR_CLASS = \"\".concat(NODE_CLASS, \"-loadindicator\");\nvar OPENED_NODE_CONTAINER_CLASS = \"\".concat(NODE_CLASS, \"-container-opened\");\nvar IS_LEAF = \"\".concat(NODE_CLASS, \"-is-leaf\");\nvar ITEM_CLASS = \"\".concat(WIDGET_CLASS, \"-item\");\nvar ITEM_WITH_CHECKBOX_CLASS = \"\".concat(ITEM_CLASS, \"-with-checkbox\");\nvar ITEM_WITHOUT_CHECKBOX_CLASS = \"\".concat(ITEM_CLASS, \"-without-checkbox\");\nvar ITEM_DATA_KEY = \"\".concat(ITEM_CLASS, \"-data\");\nvar TOGGLE_ITEM_VISIBILITY_CLASS = \"\".concat(WIDGET_CLASS, \"-toggle-item-visibility\");\nvar LOAD_INDICATOR_CLASS = \"\".concat(WIDGET_CLASS, \"-loadindicator\");\nvar LOAD_INDICATOR_WRAPPER_CLASS = \"\".concat(WIDGET_CLASS, \"-loadindicator-wrapper\");\nvar TOGGLE_ITEM_VISIBILITY_OPENED_CLASS = \"\".concat(WIDGET_CLASS, \"-toggle-item-visibility-opened\");\nvar SELECT_ALL_ITEM_CLASS = \"\".concat(WIDGET_CLASS, \"-select-all-item\");\nvar INVISIBLE_STATE_CLASS = \"dx-state-invisible\";\nvar DISABLED_STATE_CLASS = \"dx-state-disabled\";\nvar SELECTED_ITEM_CLASS = \"dx-state-selected\";\nvar EXPAND_EVENT_NAMESPACE = \"dxTreeView_expand\";\nvar DATA_ITEM_ID = \"data-item-id\";\nvar TreeViewBase = HierarchicalCollectionWidget.inherit({\n  _supportedKeys: function (e) {\n    var click = e => {\n      var $itemElement = $(this.option(\"focusedElement\"));\n\n      if (!$itemElement.length) {\n        return;\n      }\n\n      e.target = $itemElement;\n      e.currentTarget = $itemElement;\n\n      this._itemClickHandler(e, $itemElement.children(\".\" + ITEM_CLASS));\n\n      var expandEventName = this._getEventNameByOption(this.option(\"expandEvent\"));\n\n      var expandByClick = expandEventName === addNamespace(clickEventName, EXPAND_EVENT_NAMESPACE);\n\n      if (expandByClick) {\n        this._expandEventHandler(e);\n      }\n    };\n\n    var select = e => {\n      e.preventDefault();\n      var $focusedElement = $(this.option(\"focusedElement\"));\n\n      var checkboxInstance = this._getCheckBoxInstance($focusedElement);\n\n      if (!checkboxInstance.option(\"disabled\")) {\n        var currentState = checkboxInstance.option(\"value\");\n\n        this._updateItemSelection(!currentState, $focusedElement.find(\".\" + ITEM_CLASS).get(0), true);\n      }\n    };\n\n    var toggleExpandedNestedItems = function (state, e) {\n      if (!this.option(\"expandAllEnabled\")) {\n        return;\n      }\n\n      e.preventDefault();\n      var $rootElement = $(this.option(\"focusedElement\"));\n\n      if (!$rootElement.length) {\n        return;\n      }\n\n      var rootItem = this._getItemData($rootElement.find(\".\".concat(ITEM_CLASS)));\n\n      this._toggleExpandedNestedItems([rootItem], state);\n    };\n\n    return extend(this.callBase(), {\n      enter: this._showCheckboxes() ? select : click,\n      space: this._showCheckboxes() ? select : click,\n      asterisk: toggleExpandedNestedItems.bind(this, true),\n      minus: toggleExpandedNestedItems.bind(this, false)\n    });\n  },\n  _toggleExpandedNestedItems: function (items, state) {\n    if (!items) {\n      return;\n    }\n\n    for (var i = 0, len = items.length; i < len; i++) {\n      var item = items[i];\n\n      var node = this._dataAdapter.getNodeByItem(item);\n\n      this._toggleExpandedState(node, state);\n\n      this._toggleExpandedNestedItems(item.items, state);\n    }\n  },\n  _getNodeElement: function (node, cache) {\n    var key = this._encodeString(node.internalFields.key);\n\n    if (cache) {\n      if (!cache.$nodeByKey) {\n        cache.$nodeByKey = {};\n        this.$element().find(\".\".concat(NODE_CLASS)).each(function () {\n          var $node = $(this);\n          var key = $node.attr(DATA_ITEM_ID);\n          cache.$nodeByKey[key] = $node;\n        });\n      }\n\n      return cache.$nodeByKey[key] || $();\n    }\n\n    var element = this.$element().get(0).querySelector(\"[\".concat(DATA_ITEM_ID, '=\"').concat(key, '\"]'));\n    return $(element);\n  },\n  _activeStateUnit: \".\" + ITEM_CLASS,\n  _widgetClass: function () {\n    return WIDGET_CLASS;\n  },\n  _getDefaultOptions: function () {\n    var defaultOptions = extend(this.callBase(), {\n      animationEnabled: true,\n      dataStructure: \"tree\",\n      deferRendering: true,\n      expandAllEnabled: false,\n      hasItemsExpr: \"hasItems\",\n      selectNodesRecursive: true,\n      expandNodesRecursive: true,\n      showCheckBoxesMode: \"none\",\n      selectAllText: messageLocalization.format(\"dxList-selectAll\"),\n      onItemSelectionChanged: null,\n      onItemExpanded: null,\n      onItemCollapsed: null,\n      scrollDirection: \"vertical\",\n      useNativeScrolling: true,\n      virtualModeEnabled: false,\n      rootValue: 0,\n      focusStateEnabled: false,\n      selectionMode: \"multiple\",\n      expandEvent: \"dblclick\",\n      selectByClick: false,\n      createChildren: null,\n      onSelectAllValueChanged: null\n    });\n    return extend(true, defaultOptions, {\n      integrationOptions: {\n        useDeferUpdateForTemplates: false\n      }\n    });\n  },\n  _defaultOptionsRules: function () {\n    return this.callBase().concat([{\n      device: function () {\n        return !nativeScrolling;\n      },\n      options: {\n        useNativeScrolling: false\n      }\n    }]);\n  },\n  _initSelectedItems: noop,\n  _syncSelectionOptions: asyncNoop,\n  _fireSelectionChanged: function () {\n    var selectionChangePromise = this._selectionChangePromise;\n    when(selectionChangePromise).done(function () {\n      this._createActionByOption(\"onSelectionChanged\", {\n        excludeValidators: [\"disabled\", \"readOnly\"]\n      })();\n    }.bind(this));\n  },\n  _createSelectAllValueChangedAction: function () {\n    this._selectAllValueChangedAction = this._createActionByOption(\"onSelectAllValueChanged\", {\n      excludeValidators: [\"disabled\", \"readOnly\"]\n    });\n  },\n  _fireSelectAllValueChanged: function (value) {\n    this._selectAllValueChangedAction({\n      value: value\n    });\n  },\n  _checkBoxModeChange: function (value, previousValue) {\n    if (\"none\" === previousValue || \"none\" === value) {\n      this.repaint();\n      return;\n    }\n\n    var selectAllExists = this._$selectAllItem && this._$selectAllItem.length;\n\n    switch (value) {\n      case \"selectAll\":\n        if (!selectAllExists) {\n          this._createSelectAllValueChangedAction();\n\n          this._renderSelectAllItem();\n        }\n\n        break;\n\n      case \"normal\":\n        if (selectAllExists) {\n          this._$selectAllItem.remove();\n\n          delete this._$selectAllItem;\n        }\n\n    }\n  },\n  _removeSelection: function () {\n    var that = this;\n    each(this._dataAdapter.getFullData(), function (_, node) {\n      if (!that._hasChildren(node)) {\n        return;\n      }\n\n      that._dataAdapter.toggleSelection(node.internalFields.key, false, true);\n    });\n  },\n  _optionChanged: function (args) {\n    var {\n      name: name,\n      value: value,\n      previousValue: previousValue\n    } = args;\n\n    switch (name) {\n      case \"selectAllText\":\n        if (this._$selectAllItem) {\n          this._$selectAllItem.dxCheckBox(\"instance\").option(\"text\", value);\n        }\n\n        break;\n\n      case \"showCheckBoxesMode\":\n        this._checkBoxModeChange(value, previousValue);\n\n        break;\n\n      case \"scrollDirection\":\n        this.getScrollable().option(\"direction\", value);\n        break;\n\n      case \"useNativeScrolling\":\n        this.getScrollable().option(\"useNative\", value);\n        break;\n\n      case \"items\":\n        delete this._$selectAllItem;\n        this.callBase(args);\n        break;\n\n      case \"dataSource\":\n        this.callBase(args);\n\n        this._initDataAdapter();\n\n        this._filter = {};\n        break;\n\n      case \"hasItemsExpr\":\n        this._initAccessors();\n\n        this.repaint();\n        break;\n\n      case \"expandEvent\":\n        this._initExpandEvent();\n\n        break;\n\n      case \"deferRendering\":\n      case \"dataStructure\":\n      case \"rootValue\":\n      case \"createChildren\":\n      case \"expandNodesRecursive\":\n      case \"onItemSelectionChanged\":\n      case \"onItemExpanded\":\n      case \"onItemCollapsed\":\n      case \"expandAllEnabled\":\n      case \"animationEnabled\":\n      case \"virtualModeEnabled\":\n      case \"selectByClick\":\n        break;\n\n      case \"selectionMode\":\n        this._initDataAdapter();\n\n        this.callBase(args);\n        break;\n\n      case \"onSelectAllValueChanged\":\n        this._createSelectAllValueChangedAction();\n\n        break;\n\n      case \"selectNodesRecursive\":\n        this._dataAdapter.setOption(\"recursiveSelection\", args.value);\n\n        this.repaint();\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  _initDataSource: function () {\n    if (this._useCustomChildrenLoader()) {\n      this._loadChildrenByCustomLoader(null).done(function (newItems) {\n        if (newItems && newItems.length) {\n          this.option(\"items\", newItems);\n        }\n      }.bind(this));\n    } else {\n      this.callBase();\n      this._isVirtualMode() && this._initVirtualMode();\n    }\n  },\n  _initVirtualMode: function () {\n    var filter = this._filter;\n\n    if (!filter.custom) {\n      filter.custom = this._dataSource.filter();\n    }\n\n    if (!filter.internal) {\n      filter.internal = [this.option(\"parentIdExpr\"), this.option(\"rootValue\")];\n    }\n  },\n  _useCustomChildrenLoader: function () {\n    return isFunction(this.option(\"createChildren\")) && this._isDataStructurePlain();\n  },\n  _loadChildrenByCustomLoader: function (parentNode) {\n    var invocationResult = this.option(\"createChildren\").call(this, parentNode);\n\n    if (Array.isArray(invocationResult)) {\n      return new Deferred().resolve(invocationResult).promise();\n    }\n\n    if (invocationResult && isFunction(invocationResult.then)) {\n      return fromPromise(invocationResult);\n    }\n\n    return new Deferred().resolve([]).promise();\n  },\n  _combineFilter: function () {\n    if (!this._filter.custom || !this._filter.custom.length) {\n      return this._filter.internal;\n    }\n\n    return [this._filter.custom, this._filter.internal];\n  },\n  _dataSourceLoadErrorHandler: function () {\n    this._renderEmptyMessage();\n  },\n  _init: function () {\n    this._filter = {};\n    this.callBase();\n\n    this._initStoreChangeHandlers();\n  },\n  _dataSourceChangedHandler: function (newItems) {\n    var items = this.option(\"items\");\n\n    if (this._initialized && this._isVirtualMode() && items.length) {\n      return;\n    }\n\n    this.option(\"items\", newItems);\n  },\n  _removeTreeViewLoadIndicator: function () {\n    if (!this._treeViewLoadIndicator) {\n      return;\n    }\n\n    this._treeViewLoadIndicator.remove();\n\n    this._treeViewLoadIndicator = null;\n  },\n  _createTreeViewLoadIndicator: function () {\n    this._treeViewLoadIndicator = $(\"<div>\").addClass(LOAD_INDICATOR_CLASS);\n\n    this._createComponent(this._treeViewLoadIndicator, LoadIndicator, {});\n\n    return this._treeViewLoadIndicator;\n  },\n  _dataSourceLoadingChangedHandler: function (isLoading) {\n    var resultFilter;\n\n    if (this._isVirtualMode()) {\n      resultFilter = this._combineFilter();\n\n      this._dataSource.filter(resultFilter);\n    }\n\n    if (isLoading && !this._dataSource.isLoaded()) {\n      this.option(\"items\", []);\n      var $wrapper = $(\"<div>\").addClass(LOAD_INDICATOR_WRAPPER_CLASS);\n\n      this._createTreeViewLoadIndicator().appendTo($wrapper);\n\n      this.itemsContainer().append($wrapper);\n\n      if (this._isVirtualMode() && this._dataSource.filter() !== resultFilter) {\n        this._dataSource.filter([]);\n      }\n    } else {\n      this._removeTreeViewLoadIndicator();\n    }\n  },\n  _initStoreChangeHandlers: function () {\n    if (\"plain\" !== this.option(\"dataStructure\")) {\n      return;\n    }\n\n    this._dataSource && this._dataSource.store().on(\"inserted\", newItem => {\n      this.option().items = this.option(\"items\").concat(newItem);\n\n      this._dataAdapter.addItem(newItem);\n\n      if (!this._dataAdapter.isFiltered(newItem)) {\n        return;\n      }\n\n      this._updateLevel(this._parentIdGetter(newItem));\n    }).on(\"removed\", removedKey => {\n      var node = this._dataAdapter.getNodeByKey(removedKey);\n\n      if (isDefined(node)) {\n        this.option(\"items\")[this._dataAdapter.getIndexByKey(node.internalFields.key)] = 0;\n\n        this._markChildrenItemsToRemove(node);\n\n        this._removeItems();\n\n        this._dataAdapter.removeItem(removedKey);\n\n        this._updateLevel(this._parentIdGetter(node));\n      }\n    });\n  },\n  _markChildrenItemsToRemove: function (node) {\n    var keys = node.internalFields.childrenKeys;\n    each(keys, (_, key) => {\n      this.option(\"items\")[this._dataAdapter.getIndexByKey(key)] = 0;\n\n      this._markChildrenItemsToRemove(this._dataAdapter.getNodeByKey(key));\n    });\n  },\n  _removeItems: function () {\n    var items = extend(true, [], this.option(\"items\"));\n    var counter = 0;\n    each(items, (index, item) => {\n      if (!item) {\n        this.option(\"items\").splice(index - counter, 1);\n        counter++;\n      }\n    });\n  },\n  _updateLevel: function (parentId) {\n    var $container = this._getContainerByParentKey(parentId);\n\n    this._renderItems($container, this._dataAdapter.getChildrenNodes(parentId));\n  },\n  _getOldContainer: function ($itemElement) {\n    if ($itemElement.length) {\n      return $itemElement.children(\".\".concat(NODE_CONTAINER_CLASS));\n    }\n\n    var scrollable = this.getScrollable();\n\n    if (scrollable) {\n      return $(scrollable.content()).children();\n    }\n\n    return $();\n  },\n  _getContainerByParentKey: function (parentId) {\n    var node = this._dataAdapter.getNodeByKey(parentId);\n\n    var $itemElement = node ? this._getNodeElement(node) : [];\n\n    this._getOldContainer($itemElement).remove();\n\n    var $container = this._renderNodeContainer($itemElement);\n\n    if (this._isRootLevel(parentId)) {\n      var scrollable = this.getScrollable();\n\n      if (!scrollable) {\n        this._renderScrollableContainer();\n      }\n\n      $(scrollable.content()).append($container);\n    }\n\n    return $container;\n  },\n  _isRootLevel: function (parentId) {\n    return parentId === this.option(\"rootValue\");\n  },\n  _getAccessors: function () {\n    var accessors = this.callBase();\n    accessors.push(\"hasItems\");\n    return accessors;\n  },\n  _getDataAdapterOptions: function () {\n    return {\n      rootValue: this.option(\"rootValue\"),\n      multipleSelection: !this._isSingleSelection(),\n      recursiveSelection: this._isRecursiveSelection(),\n      recursiveExpansion: this.option(\"expandNodesRecursive\"),\n      selectionRequired: this.option(\"selectionRequired\"),\n      dataType: this.option(\"dataStructure\"),\n      sort: this._dataSource && this._dataSource.sort()\n    };\n  },\n  _initMarkup: function () {\n    this._renderScrollableContainer();\n\n    this._renderEmptyMessage(this._dataAdapter.getRootNodes());\n\n    this.callBase();\n    this.setAria(\"role\", \"tree\");\n  },\n  _renderContentImpl: function () {\n    var $nodeContainer = this._renderNodeContainer();\n\n    $(this.getScrollable().content()).append($nodeContainer);\n\n    if (!this.option(\"items\") || !this.option(\"items\").length) {\n      return;\n    }\n\n    this._renderItems($nodeContainer, this._dataAdapter.getRootNodes());\n\n    this._initExpandEvent();\n\n    if (this._selectAllEnabled()) {\n      this._createSelectAllValueChangedAction();\n\n      this._renderSelectAllItem($nodeContainer);\n    }\n  },\n  _isVirtualMode: function () {\n    return this.option(\"virtualModeEnabled\") && this._isDataStructurePlain() && !!this.option(\"dataSource\");\n  },\n  _isDataStructurePlain: function () {\n    return \"plain\" === this.option(\"dataStructure\");\n  },\n  _fireContentReadyAction: function () {\n    var dataSource = this.getDataSource();\n    var skipContentReadyAction = dataSource && !dataSource.isLoaded();\n    var scrollable = this.getScrollable();\n\n    if (scrollable && hasWindow()) {\n      scrollable.update();\n    }\n\n    if (!skipContentReadyAction) {\n      this.callBase();\n    }\n\n    if (scrollable && hasWindow()) {\n      scrollable.update();\n    }\n  },\n  _renderScrollableContainer: function () {\n    this._scrollable = this._createComponent($(\"<div>\").appendTo(this.$element()), Scrollable, {\n      useNative: this.option(\"useNativeScrolling\"),\n      direction: this.option(\"scrollDirection\"),\n      useKeyboard: false\n    });\n  },\n  _renderNodeContainer: function ($parent) {\n    var $container = $(\"<ul>\").addClass(NODE_CONTAINER_CLASS);\n    this.setAria(\"role\", \"group\", $container);\n\n    if ($parent && $parent.length) {\n      var itemData = this._getItemData($parent.children(\".\" + ITEM_CLASS));\n\n      if (this._expandedGetter(itemData)) {\n        $container.addClass(OPENED_NODE_CONTAINER_CLASS);\n      }\n\n      $container.appendTo($parent);\n    }\n\n    return $container;\n  },\n  _createDOMElement: function ($nodeContainer, node) {\n    var $node = $(\"<li>\").addClass(NODE_CLASS).attr(DATA_ITEM_ID, this._encodeString(node.internalFields.key)).prependTo($nodeContainer);\n    this.setAria({\n      role: \"treeitem\",\n      label: this._displayGetter(node.internalFields.item) || \"\",\n      expanded: node.internalFields.expanded || false,\n      level: this._getLevel($nodeContainer)\n    }, $node);\n    return $node;\n  },\n  _getLevel: function ($nodeContainer) {\n    var parent = $nodeContainer.parent();\n    return parent.hasClass(\"dx-scrollable-content\") ? 1 : parseInt(parent.attr(\"aria-level\")) + 1;\n  },\n  _showCheckboxes: function () {\n    return \"none\" !== this.option(\"showCheckBoxesMode\");\n  },\n  _selectAllEnabled: function () {\n    return \"selectAll\" === this.option(\"showCheckBoxesMode\") && !this._isSingleSelection();\n  },\n  _renderItems: function ($nodeContainer, nodes) {\n    var length = nodes.length - 1;\n\n    for (var i = length; i >= 0; i--) {\n      this._renderItem(i, nodes[i], $nodeContainer);\n    }\n\n    this._renderedItemsCount += nodes.length;\n  },\n  _renderItem: function (nodeIndex, node, $nodeContainer) {\n    var $node = this._createDOMElement($nodeContainer, node);\n\n    var nodeData = node.internalFields;\n\n    var showCheckBox = this._showCheckboxes();\n\n    $node.addClass(showCheckBox ? ITEM_WITH_CHECKBOX_CLASS : ITEM_WITHOUT_CHECKBOX_CLASS);\n    $node.toggleClass(INVISIBLE_STATE_CLASS, false === nodeData.item.visible);\n    showCheckBox && this._renderCheckBox($node, node);\n    this.setAria(\"selected\", nodeData.selected, $node);\n\n    this._toggleSelectedClass($node, nodeData.selected);\n\n    this.callBase(this._renderedItemsCount + nodeIndex, nodeData.item, $node);\n\n    if (false !== nodeData.item.visible) {\n      this._renderChildren($node, node);\n    }\n  },\n  _setAriaSelected: function () {},\n  _renderChildren: function ($node, node) {\n    if (!this._hasChildren(node)) {\n      this._addLeafClass($node);\n\n      return;\n    }\n\n    this._renderToggleItemVisibilityIcon($node, node);\n\n    if (this.option(\"deferRendering\") && !node.internalFields.expanded) {\n      return;\n    }\n\n    this._loadSublevel(node).done(childNodes => {\n      this._renderSublevel($node, this._getActualNode(node), childNodes);\n    });\n  },\n  _getActualNode: function (cachedNode) {\n    return this._dataAdapter.getNodeByKey(cachedNode.internalFields.key);\n  },\n  _hasChildren: function (node) {\n    if (this._isVirtualMode() || this._useCustomChildrenLoader()) {\n      return false !== this._hasItemsGetter(node.internalFields.item);\n    }\n\n    return this.callBase(node);\n  },\n  _loadSublevel: function (node) {\n    var deferred = new Deferred();\n\n    var childrenNodes = this._getChildNodes(node);\n\n    if (childrenNodes.length) {\n      deferred.resolve(childrenNodes);\n    } else {\n      this._loadNestedItems(node).done(items => {\n        deferred.resolve(this._dataAdapter.getNodesByItems(items));\n      });\n    }\n\n    return deferred.promise();\n  },\n  _renderSublevel: function ($node, node, childNodes) {\n    var $nestedNodeContainer = this._renderNodeContainer($node, node);\n\n    var childNodesByChildrenKeys = childNodes.filter(childNode => -1 !== node.internalFields.childrenKeys.indexOf(childNode.internalFields.key));\n\n    this._renderItems($nestedNodeContainer, childNodesByChildrenKeys);\n\n    if (childNodesByChildrenKeys.length && !node.internalFields.selected) {\n      var firstChild = childNodesByChildrenKeys[0];\n\n      this._updateParentsState(firstChild, this._getNodeElement(firstChild));\n    }\n\n    this._normalizeIconState($node, childNodesByChildrenKeys.length);\n\n    if (node.internalFields.expanded) {\n      $nestedNodeContainer.addClass(OPENED_NODE_CONTAINER_CLASS);\n    }\n  },\n  _executeItemRenderAction: function (itemIndex, itemData, itemElement) {\n    var node = this._getNode(itemElement);\n\n    this._getItemRenderAction()({\n      itemElement: itemElement,\n      itemIndex: itemIndex,\n      itemData: itemData,\n      node: this._dataAdapter.getPublicNode(node)\n    });\n  },\n  _addLeafClass: function ($node) {\n    $node.addClass(IS_LEAF);\n  },\n  _expandEventHandler: function (e) {\n    var $nodeElement = $(e.currentTarget.parentNode);\n\n    if (!$nodeElement.hasClass(IS_LEAF)) {\n      this._toggleExpandedState(e.currentTarget, void 0, e);\n    }\n  },\n  _initExpandEvent: function () {\n    var expandedEventName = this._getEventNameByOption(this.option(\"expandEvent\"));\n\n    var $itemsContainer = this._itemContainer();\n\n    var itemSelector = this._itemSelector();\n\n    eventsEngine.off($itemsContainer, \".\" + EXPAND_EVENT_NAMESPACE, itemSelector);\n    eventsEngine.on($itemsContainer, expandedEventName, itemSelector, this._expandEventHandler.bind(this));\n  },\n  _getEventNameByOption: function (name) {\n    var event = \"click\" === name ? clickEventName : dblclickEvent;\n    return addNamespace(event, EXPAND_EVENT_NAMESPACE);\n  },\n  _getNode: function (identifier) {\n    if (!isDefined(identifier)) {\n      return null;\n    }\n\n    if (identifier.internalFields) {\n      return identifier;\n    }\n\n    if (isPrimitive(identifier)) {\n      return this._dataAdapter.getNodeByKey(identifier);\n    }\n\n    var itemElement = $(identifier).get(0);\n\n    if (!itemElement) {\n      return null;\n    }\n\n    if (domAdapter.isElementNode(itemElement)) {\n      return this._getNodeByElement(itemElement);\n    }\n\n    return this._dataAdapter.getNodeByItem(itemElement);\n  },\n  _getNodeByElement: function (itemElement) {\n    var $node = $(itemElement).closest(\".\" + NODE_CLASS);\n\n    var key = this._decodeString($node.attr(DATA_ITEM_ID));\n\n    return this._dataAdapter.getNodeByKey(key);\n  },\n  _toggleExpandedState: function (itemElement, state, e) {\n    var node = this._getNode(itemElement);\n\n    if (!node) {\n      return new Deferred().reject().promise();\n    }\n\n    if (node.internalFields.disabled) {\n      return new Deferred().reject().promise();\n    }\n\n    var currentState = node.internalFields.expanded;\n\n    if (currentState === state) {\n      return new Deferred().resolve().promise();\n    }\n\n    if (this._hasChildren(node)) {\n      var $node = this._getNodeElement(node);\n\n      if ($node.find(\".\".concat(NODE_LOAD_INDICATOR_CLASS, \":not(.\").concat(INVISIBLE_STATE_CLASS, \")\")).length) {\n        return new Deferred().reject().promise();\n      }\n\n      this._createLoadIndicator($node);\n    }\n\n    if (!isDefined(state)) {\n      state = !currentState;\n    }\n\n    this._dataAdapter.toggleExpansion(node.internalFields.key, state);\n\n    return this._updateExpandedItemsUI(node, state, e);\n  },\n  _createLoadIndicator: function ($node) {\n    var $icon = $node.children(\".\" + TOGGLE_ITEM_VISIBILITY_CLASS);\n    var $nodeContainer = $node.children(\".\".concat(NODE_CONTAINER_CLASS));\n\n    if ($icon.hasClass(TOGGLE_ITEM_VISIBILITY_OPENED_CLASS) || $nodeContainer.not(\":empty\").length) {\n      return;\n    }\n\n    this._createComponent($(\"<div>\").addClass(NODE_LOAD_INDICATOR_CLASS), LoadIndicator, {}).$element().appendTo($node);\n\n    $icon.hide();\n  },\n  _renderToggleItemVisibilityIcon: function ($node, node) {\n    var $icon = $(\"<div>\").addClass(TOGGLE_ITEM_VISIBILITY_CLASS).appendTo($node);\n\n    if (node.internalFields.expanded) {\n      $icon.addClass(TOGGLE_ITEM_VISIBILITY_OPENED_CLASS);\n      $node.parent().addClass(OPENED_NODE_CONTAINER_CLASS);\n    }\n\n    if (node.internalFields.disabled) {\n      $icon.addClass(DISABLED_STATE_CLASS);\n    }\n\n    this._renderToggleItemVisibilityIconClick($icon, node);\n  },\n  _renderToggleItemVisibilityIconClick: function ($icon, node) {\n    var eventName = addNamespace(clickEventName, this.NAME);\n    eventsEngine.off($icon, eventName);\n    eventsEngine.on($icon, eventName, e => {\n      this._toggleExpandedState(node.internalFields.key, void 0, e);\n    });\n  },\n  _updateExpandedItemsUI: function (node, state, e) {\n    var $node = this._getNodeElement(node);\n\n    var isHiddenNode = !$node.length || state && $node.is(\":hidden\");\n\n    if (this.option(\"expandNodesRecursive\") && isHiddenNode) {\n      var parentNode = this._getNode(node.internalFields.parentKey);\n\n      if (parentNode) {\n        this._updateExpandedItemsUI(parentNode, state, e);\n      }\n    }\n\n    var $icon = $node.children(\".\" + TOGGLE_ITEM_VISIBILITY_CLASS);\n    var $nodeContainer = $node.children(\".\".concat(NODE_CONTAINER_CLASS));\n    $icon.toggleClass(TOGGLE_ITEM_VISIBILITY_OPENED_CLASS, state);\n    var nodeContainerExists = $nodeContainer.length > 0;\n    var completionCallback = new Deferred();\n\n    if (!state || nodeContainerExists && !$nodeContainer.is(\":empty\")) {\n      this._animateNodeContainer(node, state, e, completionCallback);\n\n      return completionCallback.promise();\n    }\n\n    if (0 === node.internalFields.childrenKeys.length && (this._isVirtualMode() || this._useCustomChildrenLoader())) {\n      this._loadNestedItemsWithUpdate(node, state, e, completionCallback);\n\n      return completionCallback.promise();\n    }\n\n    this._renderSublevel($node, node, this._getChildNodes(node));\n\n    this._fireContentReadyAction();\n\n    this._animateNodeContainer(node, state, e, completionCallback);\n\n    return completionCallback.promise();\n  },\n  _loadNestedItemsWithUpdate: function (node, state, e, completionCallback) {\n    var $node = this._getNodeElement(node);\n\n    this._loadNestedItems(node).done(items => {\n      var actualNodeData = this._getActualNode(node);\n\n      this._renderSublevel($node, actualNodeData, this._dataAdapter.getNodesByItems(items));\n\n      if (!items || !items.length) {\n        return;\n      }\n\n      this._fireContentReadyAction();\n\n      this._animateNodeContainer(actualNodeData, state, e, completionCallback);\n    });\n  },\n  _loadNestedItems: function (node) {\n    if (this._useCustomChildrenLoader()) {\n      var publicNode = this._dataAdapter.getPublicNode(node);\n\n      return this._loadChildrenByCustomLoader(publicNode).done(newItems => {\n        if (!this._areNodesExists(newItems)) {\n          this._appendItems(newItems);\n        }\n      });\n    }\n\n    if (!this._isVirtualMode()) {\n      return new Deferred().resolve([]).promise();\n    }\n\n    this._filter.internal = [this.option(\"parentIdExpr\"), node.internalFields.key];\n\n    this._dataSource.filter(this._combineFilter());\n\n    return this._dataSource.load().done(newItems => {\n      if (!this._areNodesExists(newItems)) {\n        this._appendItems(newItems);\n      }\n    });\n  },\n  _areNodesExists: function (newItems, items) {\n    var keyOfRootItem = this.keyOf(newItems[0]);\n\n    var fullData = this._dataAdapter.getFullData();\n\n    return !!this._dataAdapter.getNodeByKey(keyOfRootItem, fullData);\n  },\n  _appendItems: function (newItems) {\n    this.option().items = this.option(\"items\").concat(newItems);\n\n    this._initDataAdapter();\n  },\n  _animateNodeContainer: function (node, state, e, completionCallback) {\n    var $node = this._getNodeElement(node);\n\n    var $nodeContainer = $node.children(\".\".concat(NODE_CONTAINER_CLASS));\n\n    if (node && completionCallback && 0 === $nodeContainer.length) {\n      completionCallback.resolve();\n    }\n\n    $nodeContainer.addClass(OPENED_NODE_CONTAINER_CLASS);\n    var nodeHeight = getHeight($nodeContainer);\n    fx.stop($nodeContainer, true);\n    fx.animate($nodeContainer, {\n      type: \"custom\",\n      duration: this.option(\"animationEnabled\") ? 400 : 0,\n      from: {\n        maxHeight: state ? 0 : nodeHeight\n      },\n      to: {\n        maxHeight: state ? nodeHeight : 0\n      },\n      complete: function () {\n        $nodeContainer.css(\"maxHeight\", \"none\");\n        $nodeContainer.toggleClass(OPENED_NODE_CONTAINER_CLASS, state);\n        this.setAria(\"expanded\", state, $node);\n        this.getScrollable().update();\n\n        this._fireExpandedStateUpdatedEvent(state, node, e);\n\n        if (completionCallback) {\n          completionCallback.resolve();\n        }\n      }.bind(this)\n    });\n  },\n  _fireExpandedStateUpdatedEvent: function (isExpanded, node, e) {\n    if (!this._hasChildren(node)) {\n      return;\n    }\n\n    var optionName = isExpanded ? \"onItemExpanded\" : \"onItemCollapsed\";\n\n    if (isDefined(e)) {\n      this._itemDXEventHandler(e, optionName, {\n        node: this._dataAdapter.getPublicNode(node)\n      });\n    } else {\n      var target = this._getNodeElement(node);\n\n      this._itemEventHandler(target, optionName, {\n        event: e,\n        node: this._dataAdapter.getPublicNode(node)\n      });\n    }\n  },\n  _normalizeIconState: function ($node, hasNewItems) {\n    var $loadIndicator = $node.find(\".\".concat(NODE_LOAD_INDICATOR_CLASS));\n    $loadIndicator.length && LoadIndicator.getInstance($loadIndicator).option(\"visible\", false);\n\n    if (hasNewItems) {\n      var $icon = $node.find(\".\" + TOGGLE_ITEM_VISIBILITY_CLASS);\n      $icon.show();\n      return;\n    }\n\n    $node.find(\".\" + TOGGLE_ITEM_VISIBILITY_CLASS).removeClass(TOGGLE_ITEM_VISIBILITY_CLASS);\n    $node.addClass(IS_LEAF);\n  },\n  _emptyMessageContainer: function () {\n    var scrollable = this.getScrollable();\n    return scrollable ? $(scrollable.content()) : this.callBase();\n  },\n  _renderContent: function () {\n    var items = this.option(\"items\");\n\n    if (items && items.length) {\n      this._contentAlreadyRendered = true;\n    }\n\n    this.callBase();\n  },\n  _renderSelectAllItem: function ($container) {\n    $container = $container || this.$element().find(\".\".concat(NODE_CONTAINER_CLASS)).first();\n    this._$selectAllItem = $(\"<div>\").addClass(SELECT_ALL_ITEM_CLASS);\n\n    var value = this._dataAdapter.isAllSelected();\n\n    this._createComponent(this._$selectAllItem, CheckBox, {\n      value: value,\n      text: this.option(\"selectAllText\"),\n      onValueChanged: this._onSelectAllCheckboxValueChanged.bind(this)\n    });\n\n    this._toggleSelectedClass(this._$selectAllItem, value);\n\n    $container.before(this._$selectAllItem);\n  },\n  _onSelectAllCheckboxValueChanged: function (args) {\n    this._toggleSelectAll(args);\n\n    this._fireSelectAllValueChanged(args.value);\n  },\n  _toggleSelectAll: function (args) {\n    this._dataAdapter.toggleSelectAll(args.value);\n\n    this._updateItemsUI();\n\n    this._fireSelectionChanged();\n  },\n  _renderCheckBox: function ($node, node) {\n    var $checkbox = $(\"<div>\").appendTo($node);\n\n    this._createComponent($checkbox, CheckBox, {\n      value: node.internalFields.selected,\n      onValueChanged: this._changeCheckboxValue.bind(this),\n      focusStateEnabled: false,\n      disabled: this._disabledGetter(node)\n    });\n  },\n  _toggleSelectedClass: function ($node, value) {\n    $node.toggleClass(SELECTED_ITEM_CLASS, !!value);\n  },\n  _toggleNodeDisabledState: function (node, state) {\n    var $node = this._getNodeElement(node);\n\n    var $item = $node.find(\".\" + ITEM_CLASS).eq(0);\n\n    this._dataAdapter.toggleNodeDisabledState(node.internalFields.key, state);\n\n    $item.toggleClass(DISABLED_STATE_CLASS, !!state);\n\n    if (this._showCheckboxes()) {\n      var checkbox = this._getCheckBoxInstance($node);\n\n      checkbox.option(\"disabled\", !!state);\n    }\n  },\n  _itemOptionChanged: function (item, property, value) {\n    var node = this._dataAdapter.getNodeByItem(item);\n\n    if (property === this.option(\"disabledExpr\")) {\n      this._toggleNodeDisabledState(node, value);\n    }\n  },\n  _changeCheckboxValue: function (e) {\n    var $node = $(e.element).parent(\".\" + NODE_CLASS);\n    var $item = $node.children(\".\" + ITEM_CLASS);\n\n    var item = this._getItemData($item);\n\n    var node = this._getNodeByElement($item);\n\n    var value = e.value;\n\n    if (node && node.internalFields.selected === value) {\n      return;\n    }\n\n    this._updateItemSelection(value, item, e.event);\n  },\n  _isSingleSelection: function () {\n    return \"single\" === this.option(\"selectionMode\");\n  },\n  _isRecursiveSelection: function () {\n    return this.option(\"selectNodesRecursive\") && \"single\" !== this.option(\"selectionMode\");\n  },\n  _isLastSelectedBranch: function (publicNode, selectedNodesKeys, deep) {\n    var keyIndex = selectedNodesKeys.indexOf(publicNode.key);\n\n    if (keyIndex >= 0) {\n      selectedNodesKeys.splice(keyIndex, 1);\n    }\n\n    if (deep) {\n      each(publicNode.children, function (_, childNode) {\n        this._isLastSelectedBranch(childNode, selectedNodesKeys, true);\n      }.bind(this));\n    }\n\n    if (publicNode.parent) {\n      this._isLastSelectedBranch(publicNode.parent, selectedNodesKeys);\n    }\n\n    return 0 === selectedNodesKeys.length;\n  },\n  _isLastRequired: function (node) {\n    var selectionRequired = this.option(\"selectionRequired\");\n\n    var isSingleMode = this._isSingleSelection();\n\n    var selectedNodesKeys = this.getSelectedNodeKeys();\n\n    if (!selectionRequired) {\n      return;\n    }\n\n    if (isSingleMode) {\n      return 1 === selectedNodesKeys.length;\n    } else {\n      return this._isLastSelectedBranch(node.internalFields.publicNode, selectedNodesKeys.slice(), true);\n    }\n  },\n  _updateItemSelection: function (value, itemElement, dxEvent) {\n    var node = this._getNode(itemElement);\n\n    if (!node || false === node.visible) {\n      return false;\n    }\n\n    if (node.internalFields.selected === value) {\n      return true;\n    }\n\n    if (!value && this._isLastRequired(node)) {\n      if (this._showCheckboxes()) {\n        var $node = this._getNodeElement(node);\n\n        this._getCheckBoxInstance($node).option(\"value\", true);\n      }\n\n      return false;\n    }\n\n    if (value && this._isSingleSelection()) {\n      var selectedKeys = this.getSelectedNodeKeys();\n      each(selectedKeys, (index, key) => {\n        this._dataAdapter.toggleSelection(key, false);\n\n        this._updateItemsUI();\n\n        this._fireItemSelectionChanged(this._getNode(key));\n      });\n    }\n\n    this._dataAdapter.toggleSelection(node.internalFields.key, value);\n\n    var isAllSelected = this._dataAdapter.isAllSelected();\n\n    var needFireSelectAllChanged = this._selectAllEnabled() && this._$selectAllItem.dxCheckBox(\"instance\").option(\"value\") !== isAllSelected;\n\n    this._updateItemsUI();\n\n    this._fireItemSelectionChanged(node, dxEvent);\n\n    this._fireSelectionChanged();\n\n    if (needFireSelectAllChanged) {\n      this._fireSelectAllValueChanged(isAllSelected);\n    }\n\n    return true;\n  },\n  _fireItemSelectionChanged: function (node, dxEvent) {\n    var initiator = dxEvent || this._findItemElementByItem(node.internalFields.item);\n\n    var handler = dxEvent ? this._itemDXEventHandler : this._itemEventHandler;\n    handler.call(this, initiator, \"onItemSelectionChanged\", {\n      node: this._dataAdapter.getPublicNode(node),\n      itemData: node.internalFields.item\n    });\n  },\n  _getCheckBoxInstance: function ($node) {\n    return $node.children(\".dx-checkbox\").dxCheckBox(\"instance\");\n  },\n  _updateItemsUI: function () {\n    var cache = {};\n    each(this._dataAdapter.getData(), (_, node) => {\n      var $node = this._getNodeElement(node, cache);\n\n      var nodeSelection = node.internalFields.selected;\n\n      if (!$node.length) {\n        return;\n      }\n\n      this._toggleSelectedClass($node, nodeSelection);\n\n      this.setAria(\"selected\", nodeSelection, $node);\n\n      if (this._showCheckboxes()) {\n        this._getCheckBoxInstance($node).option(\"value\", nodeSelection);\n      }\n    });\n\n    if (this._selectAllEnabled()) {\n      var selectAllCheckbox = this._$selectAllItem.dxCheckBox(\"instance\");\n\n      selectAllCheckbox.option(\"onValueChanged\", void 0);\n      selectAllCheckbox.option(\"value\", this._dataAdapter.isAllSelected());\n      selectAllCheckbox.option(\"onValueChanged\", this._onSelectAllCheckboxValueChanged.bind(this));\n    }\n  },\n  _updateParentsState: function (node, $node) {\n    if (!$node) {\n      return;\n    }\n\n    var parentNode = this._dataAdapter.getNodeByKey(node.internalFields.parentKey);\n\n    var $parentNode = $($node.parents(\".\" + NODE_CLASS)[0]);\n\n    if (this._showCheckboxes()) {\n      var parentValue = parentNode.internalFields.selected;\n\n      this._getCheckBoxInstance($parentNode).option(\"value\", parentValue);\n\n      this._toggleSelectedClass($parentNode, parentValue);\n    }\n\n    if (parentNode.internalFields.parentKey !== this.option(\"rootValue\")) {\n      this._updateParentsState(parentNode, $parentNode);\n    }\n  },\n  _itemEventHandlerImpl: function (initiator, action, actionArgs) {\n    var $itemElement = $(initiator).closest(\".\" + NODE_CLASS).children(\".\" + ITEM_CLASS);\n    return action(extend(this._extendActionArgs($itemElement), actionArgs));\n  },\n  _itemContextMenuHandler: function (e) {\n    this._createEventHandler(\"onItemContextMenu\", e);\n  },\n  _itemHoldHandler: function (e) {\n    this._createEventHandler(\"onItemHold\", e);\n  },\n  _createEventHandler: function (eventName, e) {\n    var node = this._getNodeByElement(e.currentTarget);\n\n    this._itemDXEventHandler(e, eventName, {\n      node: this._dataAdapter.getPublicNode(node)\n    });\n  },\n  _itemClass: function () {\n    return ITEM_CLASS;\n  },\n  _itemDataKey: function () {\n    return ITEM_DATA_KEY;\n  },\n  _attachClickEvent: function () {\n    var clickSelector = \".\" + this._itemClass();\n\n    var pointerDownSelector = \".\" + NODE_CLASS + \", .\" + SELECT_ALL_ITEM_CLASS;\n    var eventName = addNamespace(clickEventName, this.NAME);\n    var pointerDownEvent = addNamespace(pointerEvents.down, this.NAME);\n\n    var $itemContainer = this._itemContainer();\n\n    var that = this;\n    eventsEngine.off($itemContainer, eventName, clickSelector);\n    eventsEngine.off($itemContainer, pointerDownEvent, pointerDownSelector);\n    eventsEngine.on($itemContainer, eventName, clickSelector, function (e) {\n      that._itemClickHandler(e, $(this));\n    });\n    eventsEngine.on($itemContainer, pointerDownEvent, pointerDownSelector, function (e) {\n      that._itemPointerDownHandler(e);\n    });\n  },\n  _itemClickHandler: function (e, $item) {\n    var itemData = this._getItemData($item);\n\n    var node = this._getNodeByElement($item);\n\n    this._itemDXEventHandler(e, \"onItemClick\", {\n      node: this._dataAdapter.getPublicNode(node)\n    });\n\n    if (this.option(\"selectByClick\") && !e.isDefaultPrevented()) {\n      this._updateItemSelection(!node.internalFields.selected, itemData, e);\n    }\n  },\n  _updateSelectionToFirstItem: function ($items, startIndex) {\n    var itemIndex = startIndex;\n\n    while (itemIndex >= 0) {\n      var $item = $($items[itemIndex]);\n\n      this._updateItemSelection(true, $item.find(\".\" + ITEM_CLASS).get(0));\n\n      itemIndex--;\n    }\n  },\n  _updateSelectionToLastItem: function ($items, startIndex) {\n    var length = $items.length;\n    var itemIndex = startIndex;\n\n    while (itemIndex < length) {\n      var $item = $($items[itemIndex]);\n\n      this._updateItemSelection(true, $item.find(\".\" + ITEM_CLASS).get(0));\n\n      itemIndex++;\n    }\n  },\n  _focusInHandler: function (e) {\n    this._updateFocusState(e, true);\n\n    if (this.option(\"focusedElement\")) {\n      clearTimeout(this._setFocusedItemTimeout);\n      this._setFocusedItemTimeout = setTimeout(() => {\n        this._setFocusedItem($(this.option(\"focusedElement\")));\n      });\n      return;\n    }\n\n    var $activeItem = this._getActiveItem();\n\n    this.option(\"focusedElement\", getPublicElement($activeItem.closest(\".\" + NODE_CLASS)));\n  },\n  _setFocusedItem: function ($target) {\n    if (!$target || !$target.length) {\n      return;\n    }\n\n    if (!$target.children().hasClass(DISABLED_STATE_CLASS)) {\n      this.callBase($target);\n    }\n  },\n  _itemPointerDownHandler: function (e) {\n    if (!this.option(\"focusStateEnabled\")) {\n      return;\n    }\n\n    var $target = $(e.target).closest(\".\" + NODE_CLASS + \", .\" + SELECT_ALL_ITEM_CLASS);\n\n    if (!$target.length) {\n      return;\n    }\n\n    var itemElement = $target.hasClass(DISABLED_STATE_CLASS) ? null : $target;\n    this.option(\"focusedElement\", getPublicElement(itemElement));\n  },\n  _findNonDisabledNodes: function ($nodes) {\n    return $nodes.not(function () {\n      return $(this).children(\".\" + ITEM_CLASS).hasClass(DISABLED_STATE_CLASS);\n    });\n  },\n  _moveFocus: function (location, e) {\n    var FOCUS_UP = \"up\";\n    var FOCUS_DOWN = \"down\";\n    var FOCUS_FIRST = \"first\";\n    var FOCUS_LAST = \"last\";\n    var FOCUS_LEFT = this.option(\"rtlEnabled\") ? \"right\" : \"left\";\n    var FOCUS_RIGHT = this.option(\"rtlEnabled\") ? \"left\" : \"right\";\n    this.$element().find(\".\".concat(NODE_CONTAINER_CLASS)).each(function () {\n      fx.stop(this, true);\n    });\n\n    var $items = this._findNonDisabledNodes(this._nodeElements());\n\n    if (!$items || !$items.length) {\n      return;\n    }\n\n    switch (location) {\n      case FOCUS_UP:\n        var $prevItem = this._prevItem($items);\n\n        this.option(\"focusedElement\", getPublicElement($prevItem));\n\n        var prevItemElement = this._getNodeItemElement($prevItem);\n\n        this.getScrollable().scrollToElement(prevItemElement);\n\n        if (e.shiftKey && this._showCheckboxes()) {\n          this._updateItemSelection(true, prevItemElement);\n        }\n\n        break;\n\n      case FOCUS_DOWN:\n        var $nextItem = this._nextItem($items);\n\n        this.option(\"focusedElement\", getPublicElement($nextItem));\n\n        var nextItemElement = this._getNodeItemElement($nextItem);\n\n        this.getScrollable().scrollToElement(nextItemElement);\n\n        if (e.shiftKey && this._showCheckboxes()) {\n          this._updateItemSelection(true, nextItemElement);\n        }\n\n        break;\n\n      case FOCUS_FIRST:\n        var $firstItem = $items.first();\n\n        if (e.shiftKey && this._showCheckboxes()) {\n          this._updateSelectionToFirstItem($items, $items.index(this._prevItem($items)));\n        }\n\n        this.option(\"focusedElement\", getPublicElement($firstItem));\n        this.getScrollable().scrollToElement(this._getNodeItemElement($firstItem));\n        break;\n\n      case FOCUS_LAST:\n        var $lastItem = $items.last();\n\n        if (e.shiftKey && this._showCheckboxes()) {\n          this._updateSelectionToLastItem($items, $items.index(this._nextItem($items)));\n        }\n\n        this.option(\"focusedElement\", getPublicElement($lastItem));\n        this.getScrollable().scrollToElement(this._getNodeItemElement($lastItem));\n        break;\n\n      case FOCUS_RIGHT:\n        this._expandFocusedContainer();\n\n        break;\n\n      case FOCUS_LEFT:\n        this._collapseFocusedContainer();\n\n        break;\n\n      default:\n        this.callBase.apply(this, arguments);\n        return;\n    }\n  },\n  _getNodeItemElement: function ($node) {\n    return $node.find(\".\" + ITEM_CLASS).get(0);\n  },\n  _nodeElements: function () {\n    return this.$element().find(\".\" + NODE_CLASS).not(\":hidden\");\n  },\n  _expandFocusedContainer: function () {\n    var $focusedNode = $(this.option(\"focusedElement\"));\n\n    if (!$focusedNode.length || $focusedNode.hasClass(IS_LEAF)) {\n      return;\n    }\n\n    var $node = $focusedNode.find(\".\".concat(NODE_CONTAINER_CLASS)).eq(0);\n\n    if ($node.hasClass(OPENED_NODE_CONTAINER_CLASS)) {\n      var $nextItem = this._nextItem(this._findNonDisabledNodes(this._nodeElements()));\n\n      this.option(\"focusedElement\", getPublicElement($nextItem));\n      this.getScrollable().scrollToElement(this._getNodeItemElement($nextItem));\n      return;\n    }\n\n    var node = this._getNodeByElement($focusedNode.children(\".\" + ITEM_CLASS));\n\n    this._toggleExpandedState(node, true);\n  },\n  _getClosestNonDisabledNode: function ($node) {\n    do {\n      $node = $node.parent().closest(\".\" + NODE_CLASS);\n    } while ($node.children(\".dx-treeview-item.dx-state-disabled\").length);\n\n    return $node;\n  },\n  _collapseFocusedContainer: function () {\n    var $focusedNode = $(this.option(\"focusedElement\"));\n\n    if (!$focusedNode.length) {\n      return;\n    }\n\n    var nodeElement = $focusedNode.find(\".\".concat(NODE_CONTAINER_CLASS)).eq(0);\n\n    if (!$focusedNode.hasClass(IS_LEAF) && nodeElement.hasClass(OPENED_NODE_CONTAINER_CLASS)) {\n      var node = this._getNodeByElement($focusedNode.children(\".\" + ITEM_CLASS));\n\n      this._toggleExpandedState(node, false);\n    } else {\n      var collapsedNode = this._getClosestNonDisabledNode($focusedNode);\n\n      collapsedNode.length && this.option(\"focusedElement\", getPublicElement(collapsedNode));\n      this.getScrollable().scrollToElement(this._getNodeItemElement(collapsedNode));\n    }\n  },\n  _encodeString: function (value) {\n    return isString(value) ? encodeURI(value) : value;\n  },\n  _decodeString: function (value) {\n    return isString(value) ? decodeURI(value) : value;\n  },\n  getScrollable: function () {\n    return this._scrollable;\n  },\n  updateDimensions: function () {\n    var deferred = new Deferred();\n    var scrollable = this.getScrollable();\n\n    if (scrollable) {\n      scrollable.update().done(() => {\n        deferred.resolveWith(this);\n      });\n    } else {\n      deferred.resolveWith(this);\n    }\n\n    return deferred.promise();\n  },\n  selectItem: function (itemElement) {\n    return this._updateItemSelection(true, itemElement);\n  },\n  unselectItem: function (itemElement) {\n    return this._updateItemSelection(false, itemElement);\n  },\n  expandItem: function (itemElement) {\n    return this._toggleExpandedState(itemElement, true);\n  },\n  collapseItem: function (itemElement) {\n    return this._toggleExpandedState(itemElement, false);\n  },\n  getNodes: function () {\n    return this._dataAdapter.getTreeNodes();\n  },\n  getSelectedNodes: function () {\n    return this.getSelectedNodeKeys().map(key => {\n      var node = this._dataAdapter.getNodeByKey(key);\n\n      return this._dataAdapter.getPublicNode(node);\n    });\n  },\n  getSelectedNodesKeys: function () {\n    errors.log(\"W0002\", \"dxTreeView\", \"getSelectedNodesKeys\", \"20.1\", \"Use the 'getSelectedNodeKeys' method instead\");\n    return this.getSelectedNodeKeys();\n  },\n  getSelectedNodeKeys: function () {\n    return this._dataAdapter.getSelectedNodesKeys();\n  },\n  selectAll: function () {\n    if (this._selectAllEnabled()) {\n      this._$selectAllItem.dxCheckBox(\"instance\").option(\"value\", true);\n    } else {\n      this._toggleSelectAll({\n        value: true\n      });\n    }\n  },\n  unselectAll: function () {\n    if (this._selectAllEnabled()) {\n      this._$selectAllItem.dxCheckBox(\"instance\").option(\"value\", false);\n    } else {\n      this._toggleSelectAll({\n        value: false\n      });\n    }\n  },\n  expandAll: function () {\n    var dataAdapter = this._dataAdapter;\n    each(dataAdapter.getData(), (_, node) => dataAdapter.toggleExpansion(node.internalFields.key, true));\n    this.repaint();\n  },\n  collapseAll: function () {\n    each(this._dataAdapter.getExpandedNodesKeys(), function (_, key) {\n      this._toggleExpandedState(key, false);\n    }.bind(this));\n  },\n  scrollToItem: function (keyOrItemOrElement) {\n    var node = this._getNode(keyOrItemOrElement);\n\n    if (!node) {\n      return new Deferred().reject().promise();\n    }\n\n    var nodeKeysToExpand = [];\n    var parentNode = node.internalFields.publicNode.parent;\n\n    while (null != parentNode) {\n      if (!parentNode.expanded) {\n        nodeKeysToExpand.push(parentNode.key);\n      }\n\n      parentNode = parentNode.parent;\n    }\n\n    var scrollCallback = new Deferred();\n\n    this._expandNodes(nodeKeysToExpand.reverse()).always(() => {\n      var $element = this._getNodeElement(node);\n\n      if ($element && $element.length) {\n        this.scrollToElementTopLeft($element.get(0));\n        scrollCallback.resolve();\n      } else {\n        scrollCallback.reject();\n      }\n    });\n\n    return scrollCallback.promise();\n  },\n  scrollToElementTopLeft: function (targetElement) {\n    var scrollable = this.getScrollable();\n    var {\n      scrollDirection: scrollDirection,\n      rtlEnabled: rtlEnabled\n    } = this.option();\n    var targetLocation = {\n      top: 0,\n      left: 0\n    };\n    var relativeOffset = getRelativeOffset(SCROLLABLE_CONTENT_CLASS, targetElement);\n\n    if (scrollDirection !== DIRECTION_VERTICAL) {\n      var containerElement = $(scrollable.container()).get(0);\n      targetLocation.left = rtlEnabled ? relativeOffset.left + targetElement.offsetWidth - containerElement.clientWidth : relativeOffset.left;\n    }\n\n    if (scrollDirection !== DIRECTION_HORIZONTAL) {\n      targetLocation.top = relativeOffset.top;\n    }\n\n    scrollable.scrollTo(targetLocation);\n  },\n  _expandNodes: function (keysToExpand) {\n    if (!keysToExpand || 0 === keysToExpand.length) {\n      return new Deferred().resolve().promise();\n    }\n\n    var resultCallback = new Deferred();\n    var callbacksByNodes = keysToExpand.map(key => this.expandItem(key));\n    when.apply($, callbacksByNodes).done(() => resultCallback.resolve()).fail(() => resultCallback.reject());\n    return resultCallback.promise();\n  },\n  _dispose: function () {\n    this.callBase();\n    clearTimeout(this._setFocusedItemTimeout);\n  }\n});\nexport default TreeViewBase;","map":{"version":3,"sources":["/home/chrswndrs/Documents/poc/typescript/angular/kid/node_modules/devextreme/esm/ui/tree_view/ui.tree_view.base.js"],"names":["getHeight","$","domAdapter","eventsEngine","messageLocalization","name","clickEventName","asyncNoop","noop","hasWindow","isDefined","isPrimitive","isFunction","isString","extend","each","getPublicElement","CheckBox","HierarchicalCollectionWidget","addNamespace","pointerEvents","dblclickEvent","fx","Scrollable","LoadIndicator","fromPromise","Deferred","when","errors","nativeScrolling","getRelativeOffset","SCROLLABLE_CONTENT_CLASS","DIRECTION_HORIZONTAL","DIRECTION_VERTICAL","WIDGET_CLASS","NODE_CLASS","concat","NODE_CONTAINER_CLASS","NODE_LOAD_INDICATOR_CLASS","OPENED_NODE_CONTAINER_CLASS","IS_LEAF","ITEM_CLASS","ITEM_WITH_CHECKBOX_CLASS","ITEM_WITHOUT_CHECKBOX_CLASS","ITEM_DATA_KEY","TOGGLE_ITEM_VISIBILITY_CLASS","LOAD_INDICATOR_CLASS","LOAD_INDICATOR_WRAPPER_CLASS","TOGGLE_ITEM_VISIBILITY_OPENED_CLASS","SELECT_ALL_ITEM_CLASS","INVISIBLE_STATE_CLASS","DISABLED_STATE_CLASS","SELECTED_ITEM_CLASS","EXPAND_EVENT_NAMESPACE","DATA_ITEM_ID","TreeViewBase","inherit","_supportedKeys","e","click","$itemElement","option","length","target","currentTarget","_itemClickHandler","children","expandEventName","_getEventNameByOption","expandByClick","_expandEventHandler","select","preventDefault","$focusedElement","checkboxInstance","_getCheckBoxInstance","currentState","_updateItemSelection","find","get","toggleExpandedNestedItems","state","$rootElement","rootItem","_getItemData","_toggleExpandedNestedItems","callBase","enter","_showCheckboxes","space","asterisk","bind","minus","items","i","len","item","node","_dataAdapter","getNodeByItem","_toggleExpandedState","_getNodeElement","cache","key","_encodeString","internalFields","$nodeByKey","$element","$node","attr","element","querySelector","_activeStateUnit","_widgetClass","_getDefaultOptions","defaultOptions","animationEnabled","dataStructure","deferRendering","expandAllEnabled","hasItemsExpr","selectNodesRecursive","expandNodesRecursive","showCheckBoxesMode","selectAllText","format","onItemSelectionChanged","onItemExpanded","onItemCollapsed","scrollDirection","useNativeScrolling","virtualModeEnabled","rootValue","focusStateEnabled","selectionMode","expandEvent","selectByClick","createChildren","onSelectAllValueChanged","integrationOptions","useDeferUpdateForTemplates","_defaultOptionsRules","device","options","_initSelectedItems","_syncSelectionOptions","_fireSelectionChanged","selectionChangePromise","_selectionChangePromise","done","_createActionByOption","excludeValidators","_createSelectAllValueChangedAction","_selectAllValueChangedAction","_fireSelectAllValueChanged","value","_checkBoxModeChange","previousValue","repaint","selectAllExists","_$selectAllItem","_renderSelectAllItem","remove","_removeSelection","that","getFullData","_","_hasChildren","toggleSelection","_optionChanged","args","dxCheckBox","getScrollable","_initDataAdapter","_filter","_initAccessors","_initExpandEvent","setOption","_initDataSource","_useCustomChildrenLoader","_loadChildrenByCustomLoader","newItems","_isVirtualMode","_initVirtualMode","filter","custom","_dataSource","internal","_isDataStructurePlain","parentNode","invocationResult","call","Array","isArray","resolve","promise","then","_combineFilter","_dataSourceLoadErrorHandler","_renderEmptyMessage","_init","_initStoreChangeHandlers","_dataSourceChangedHandler","_initialized","_removeTreeViewLoadIndicator","_treeViewLoadIndicator","_createTreeViewLoadIndicator","addClass","_createComponent","_dataSourceLoadingChangedHandler","isLoading","resultFilter","isLoaded","$wrapper","appendTo","itemsContainer","append","store","on","newItem","addItem","isFiltered","_updateLevel","_parentIdGetter","removedKey","getNodeByKey","getIndexByKey","_markChildrenItemsToRemove","_removeItems","removeItem","keys","childrenKeys","counter","index","splice","parentId","$container","_getContainerByParentKey","_renderItems","getChildrenNodes","_getOldContainer","scrollable","content","_renderNodeContainer","_isRootLevel","_renderScrollableContainer","_getAccessors","accessors","push","_getDataAdapterOptions","multipleSelection","_isSingleSelection","recursiveSelection","_isRecursiveSelection","recursiveExpansion","selectionRequired","dataType","sort","_initMarkup","getRootNodes","setAria","_renderContentImpl","$nodeContainer","_selectAllEnabled","_fireContentReadyAction","dataSource","getDataSource","skipContentReadyAction","update","_scrollable","useNative","direction","useKeyboard","$parent","itemData","_expandedGetter","_createDOMElement","prependTo","role","label","_displayGetter","expanded","level","_getLevel","parent","hasClass","parseInt","nodes","_renderItem","_renderedItemsCount","nodeIndex","nodeData","showCheckBox","toggleClass","visible","_renderCheckBox","selected","_toggleSelectedClass","_renderChildren","_setAriaSelected","_addLeafClass","_renderToggleItemVisibilityIcon","_loadSublevel","childNodes","_renderSublevel","_getActualNode","cachedNode","_hasItemsGetter","deferred","childrenNodes","_getChildNodes","_loadNestedItems","getNodesByItems","$nestedNodeContainer","childNodesByChildrenKeys","childNode","indexOf","firstChild","_updateParentsState","_normalizeIconState","_executeItemRenderAction","itemIndex","itemElement","_getNode","_getItemRenderAction","getPublicNode","$nodeElement","expandedEventName","$itemsContainer","_itemContainer","itemSelector","_itemSelector","off","event","identifier","isElementNode","_getNodeByElement","closest","_decodeString","reject","disabled","_createLoadIndicator","toggleExpansion","_updateExpandedItemsUI","$icon","not","hide","_renderToggleItemVisibilityIconClick","eventName","NAME","isHiddenNode","is","parentKey","nodeContainerExists","completionCallback","_animateNodeContainer","_loadNestedItemsWithUpdate","actualNodeData","publicNode","_areNodesExists","_appendItems","load","keyOfRootItem","keyOf","fullData","nodeHeight","stop","animate","type","duration","from","maxHeight","to","complete","css","_fireExpandedStateUpdatedEvent","isExpanded","optionName","_itemDXEventHandler","_itemEventHandler","hasNewItems","$loadIndicator","getInstance","show","removeClass","_emptyMessageContainer","_renderContent","_contentAlreadyRendered","first","isAllSelected","text","onValueChanged","_onSelectAllCheckboxValueChanged","before","_toggleSelectAll","toggleSelectAll","_updateItemsUI","$checkbox","_changeCheckboxValue","_disabledGetter","_toggleNodeDisabledState","$item","eq","toggleNodeDisabledState","checkbox","_itemOptionChanged","property","_isLastSelectedBranch","selectedNodesKeys","deep","keyIndex","_isLastRequired","isSingleMode","getSelectedNodeKeys","slice","dxEvent","selectedKeys","_fireItemSelectionChanged","needFireSelectAllChanged","initiator","_findItemElementByItem","handler","getData","nodeSelection","selectAllCheckbox","$parentNode","parents","parentValue","_itemEventHandlerImpl","action","actionArgs","_extendActionArgs","_itemContextMenuHandler","_createEventHandler","_itemHoldHandler","_itemClass","_itemDataKey","_attachClickEvent","clickSelector","pointerDownSelector","pointerDownEvent","down","$itemContainer","_itemPointerDownHandler","isDefaultPrevented","_updateSelectionToFirstItem","$items","startIndex","_updateSelectionToLastItem","_focusInHandler","_updateFocusState","clearTimeout","_setFocusedItemTimeout","setTimeout","_setFocusedItem","$activeItem","_getActiveItem","$target","_findNonDisabledNodes","$nodes","_moveFocus","location","FOCUS_UP","FOCUS_DOWN","FOCUS_FIRST","FOCUS_LAST","FOCUS_LEFT","FOCUS_RIGHT","_nodeElements","$prevItem","_prevItem","prevItemElement","_getNodeItemElement","scrollToElement","shiftKey","$nextItem","_nextItem","nextItemElement","$firstItem","$lastItem","last","_expandFocusedContainer","_collapseFocusedContainer","apply","arguments","$focusedNode","_getClosestNonDisabledNode","nodeElement","collapsedNode","encodeURI","decodeURI","updateDimensions","resolveWith","selectItem","unselectItem","expandItem","collapseItem","getNodes","getTreeNodes","getSelectedNodes","map","getSelectedNodesKeys","log","selectAll","unselectAll","expandAll","dataAdapter","collapseAll","getExpandedNodesKeys","scrollToItem","keyOrItemOrElement","nodeKeysToExpand","scrollCallback","_expandNodes","reverse","always","scrollToElementTopLeft","targetElement","rtlEnabled","targetLocation","top","left","relativeOffset","containerElement","container","offsetWidth","clientWidth","scrollTo","keysToExpand","resultCallback","callbacksByNodes","fail","_dispose"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/tree_view/ui.tree_view.base.js)\r\n * Version: 21.2.4\r\n * Build date: Mon Dec 06 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    getHeight\r\n} from \"../../core/utils/size\";\r\nimport $ from \"../../core/renderer\";\r\nimport domAdapter from \"../../core/dom_adapter\";\r\nimport eventsEngine from \"../../events/core/events_engine\";\r\nimport messageLocalization from \"../../localization/message\";\r\nimport {\r\n    name as clickEventName\r\n} from \"../../events/click\";\r\nimport {\r\n    asyncNoop,\r\n    noop\r\n} from \"../../core/utils/common\";\r\nimport {\r\n    hasWindow\r\n} from \"../../core/utils/window\";\r\nimport {\r\n    isDefined,\r\n    isPrimitive,\r\n    isFunction,\r\n    isString\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    each\r\n} from \"../../core/utils/iterator\";\r\nimport {\r\n    getPublicElement\r\n} from \"../../core/element\";\r\nimport CheckBox from \"../check_box\";\r\nimport HierarchicalCollectionWidget from \"../hierarchical_collection/ui.hierarchical_collection_widget\";\r\nimport {\r\n    addNamespace\r\n} from \"../../events/utils/index\";\r\nimport pointerEvents from \"../../events/pointer\";\r\nimport {\r\n    name as dblclickEvent\r\n} from \"../../events/double_click\";\r\nimport fx from \"../../animation/fx\";\r\nimport Scrollable from \"../scroll_view/ui.scrollable\";\r\nimport LoadIndicator from \"../load_indicator\";\r\nimport {\r\n    fromPromise,\r\n    Deferred,\r\n    when\r\n} from \"../../core/utils/deferred\";\r\nimport errors from \"../widget/ui.errors\";\r\nimport {\r\n    nativeScrolling\r\n} from \"../../core/utils/support\";\r\nimport {\r\n    getRelativeOffset\r\n} from \"../../renovation/ui/scroll_view/utils/get_relative_offset\";\r\nimport {\r\n    SCROLLABLE_CONTENT_CLASS,\r\n    DIRECTION_HORIZONTAL,\r\n    DIRECTION_VERTICAL\r\n} from \"../../renovation/ui/scroll_view/common/consts\";\r\nvar WIDGET_CLASS = \"dx-treeview\";\r\nvar NODE_CLASS = \"\".concat(WIDGET_CLASS, \"-node\");\r\nvar NODE_CONTAINER_CLASS = \"\".concat(NODE_CLASS, \"-container\");\r\nvar NODE_LOAD_INDICATOR_CLASS = \"\".concat(NODE_CLASS, \"-loadindicator\");\r\nvar OPENED_NODE_CONTAINER_CLASS = \"\".concat(NODE_CLASS, \"-container-opened\");\r\nvar IS_LEAF = \"\".concat(NODE_CLASS, \"-is-leaf\");\r\nvar ITEM_CLASS = \"\".concat(WIDGET_CLASS, \"-item\");\r\nvar ITEM_WITH_CHECKBOX_CLASS = \"\".concat(ITEM_CLASS, \"-with-checkbox\");\r\nvar ITEM_WITHOUT_CHECKBOX_CLASS = \"\".concat(ITEM_CLASS, \"-without-checkbox\");\r\nvar ITEM_DATA_KEY = \"\".concat(ITEM_CLASS, \"-data\");\r\nvar TOGGLE_ITEM_VISIBILITY_CLASS = \"\".concat(WIDGET_CLASS, \"-toggle-item-visibility\");\r\nvar LOAD_INDICATOR_CLASS = \"\".concat(WIDGET_CLASS, \"-loadindicator\");\r\nvar LOAD_INDICATOR_WRAPPER_CLASS = \"\".concat(WIDGET_CLASS, \"-loadindicator-wrapper\");\r\nvar TOGGLE_ITEM_VISIBILITY_OPENED_CLASS = \"\".concat(WIDGET_CLASS, \"-toggle-item-visibility-opened\");\r\nvar SELECT_ALL_ITEM_CLASS = \"\".concat(WIDGET_CLASS, \"-select-all-item\");\r\nvar INVISIBLE_STATE_CLASS = \"dx-state-invisible\";\r\nvar DISABLED_STATE_CLASS = \"dx-state-disabled\";\r\nvar SELECTED_ITEM_CLASS = \"dx-state-selected\";\r\nvar EXPAND_EVENT_NAMESPACE = \"dxTreeView_expand\";\r\nvar DATA_ITEM_ID = \"data-item-id\";\r\nvar TreeViewBase = HierarchicalCollectionWidget.inherit({\r\n    _supportedKeys: function(e) {\r\n        var click = e => {\r\n            var $itemElement = $(this.option(\"focusedElement\"));\r\n            if (!$itemElement.length) {\r\n                return\r\n            }\r\n            e.target = $itemElement;\r\n            e.currentTarget = $itemElement;\r\n            this._itemClickHandler(e, $itemElement.children(\".\" + ITEM_CLASS));\r\n            var expandEventName = this._getEventNameByOption(this.option(\"expandEvent\"));\r\n            var expandByClick = expandEventName === addNamespace(clickEventName, EXPAND_EVENT_NAMESPACE);\r\n            if (expandByClick) {\r\n                this._expandEventHandler(e)\r\n            }\r\n        };\r\n        var select = e => {\r\n            e.preventDefault();\r\n            var $focusedElement = $(this.option(\"focusedElement\"));\r\n            var checkboxInstance = this._getCheckBoxInstance($focusedElement);\r\n            if (!checkboxInstance.option(\"disabled\")) {\r\n                var currentState = checkboxInstance.option(\"value\");\r\n                this._updateItemSelection(!currentState, $focusedElement.find(\".\" + ITEM_CLASS).get(0), true)\r\n            }\r\n        };\r\n        var toggleExpandedNestedItems = function(state, e) {\r\n            if (!this.option(\"expandAllEnabled\")) {\r\n                return\r\n            }\r\n            e.preventDefault();\r\n            var $rootElement = $(this.option(\"focusedElement\"));\r\n            if (!$rootElement.length) {\r\n                return\r\n            }\r\n            var rootItem = this._getItemData($rootElement.find(\".\".concat(ITEM_CLASS)));\r\n            this._toggleExpandedNestedItems([rootItem], state)\r\n        };\r\n        return extend(this.callBase(), {\r\n            enter: this._showCheckboxes() ? select : click,\r\n            space: this._showCheckboxes() ? select : click,\r\n            asterisk: toggleExpandedNestedItems.bind(this, true),\r\n            minus: toggleExpandedNestedItems.bind(this, false)\r\n        })\r\n    },\r\n    _toggleExpandedNestedItems: function(items, state) {\r\n        if (!items) {\r\n            return\r\n        }\r\n        for (var i = 0, len = items.length; i < len; i++) {\r\n            var item = items[i];\r\n            var node = this._dataAdapter.getNodeByItem(item);\r\n            this._toggleExpandedState(node, state);\r\n            this._toggleExpandedNestedItems(item.items, state)\r\n        }\r\n    },\r\n    _getNodeElement: function(node, cache) {\r\n        var key = this._encodeString(node.internalFields.key);\r\n        if (cache) {\r\n            if (!cache.$nodeByKey) {\r\n                cache.$nodeByKey = {};\r\n                this.$element().find(\".\".concat(NODE_CLASS)).each((function() {\r\n                    var $node = $(this);\r\n                    var key = $node.attr(DATA_ITEM_ID);\r\n                    cache.$nodeByKey[key] = $node\r\n                }))\r\n            }\r\n            return cache.$nodeByKey[key] || $()\r\n        }\r\n        var element = this.$element().get(0).querySelector(\"[\".concat(DATA_ITEM_ID, '=\"').concat(key, '\"]'));\r\n        return $(element)\r\n    },\r\n    _activeStateUnit: \".\" + ITEM_CLASS,\r\n    _widgetClass: function() {\r\n        return WIDGET_CLASS\r\n    },\r\n    _getDefaultOptions: function() {\r\n        var defaultOptions = extend(this.callBase(), {\r\n            animationEnabled: true,\r\n            dataStructure: \"tree\",\r\n            deferRendering: true,\r\n            expandAllEnabled: false,\r\n            hasItemsExpr: \"hasItems\",\r\n            selectNodesRecursive: true,\r\n            expandNodesRecursive: true,\r\n            showCheckBoxesMode: \"none\",\r\n            selectAllText: messageLocalization.format(\"dxList-selectAll\"),\r\n            onItemSelectionChanged: null,\r\n            onItemExpanded: null,\r\n            onItemCollapsed: null,\r\n            scrollDirection: \"vertical\",\r\n            useNativeScrolling: true,\r\n            virtualModeEnabled: false,\r\n            rootValue: 0,\r\n            focusStateEnabled: false,\r\n            selectionMode: \"multiple\",\r\n            expandEvent: \"dblclick\",\r\n            selectByClick: false,\r\n            createChildren: null,\r\n            onSelectAllValueChanged: null\r\n        });\r\n        return extend(true, defaultOptions, {\r\n            integrationOptions: {\r\n                useDeferUpdateForTemplates: false\r\n            }\r\n        })\r\n    },\r\n    _defaultOptionsRules: function() {\r\n        return this.callBase().concat([{\r\n            device: function() {\r\n                return !nativeScrolling\r\n            },\r\n            options: {\r\n                useNativeScrolling: false\r\n            }\r\n        }])\r\n    },\r\n    _initSelectedItems: noop,\r\n    _syncSelectionOptions: asyncNoop,\r\n    _fireSelectionChanged: function() {\r\n        var selectionChangePromise = this._selectionChangePromise;\r\n        when(selectionChangePromise).done(function() {\r\n            this._createActionByOption(\"onSelectionChanged\", {\r\n                excludeValidators: [\"disabled\", \"readOnly\"]\r\n            })()\r\n        }.bind(this))\r\n    },\r\n    _createSelectAllValueChangedAction: function() {\r\n        this._selectAllValueChangedAction = this._createActionByOption(\"onSelectAllValueChanged\", {\r\n            excludeValidators: [\"disabled\", \"readOnly\"]\r\n        })\r\n    },\r\n    _fireSelectAllValueChanged: function(value) {\r\n        this._selectAllValueChangedAction({\r\n            value: value\r\n        })\r\n    },\r\n    _checkBoxModeChange: function(value, previousValue) {\r\n        if (\"none\" === previousValue || \"none\" === value) {\r\n            this.repaint();\r\n            return\r\n        }\r\n        var selectAllExists = this._$selectAllItem && this._$selectAllItem.length;\r\n        switch (value) {\r\n            case \"selectAll\":\r\n                if (!selectAllExists) {\r\n                    this._createSelectAllValueChangedAction();\r\n                    this._renderSelectAllItem()\r\n                }\r\n                break;\r\n            case \"normal\":\r\n                if (selectAllExists) {\r\n                    this._$selectAllItem.remove();\r\n                    delete this._$selectAllItem\r\n                }\r\n        }\r\n    },\r\n    _removeSelection: function() {\r\n        var that = this;\r\n        each(this._dataAdapter.getFullData(), (function(_, node) {\r\n            if (!that._hasChildren(node)) {\r\n                return\r\n            }\r\n            that._dataAdapter.toggleSelection(node.internalFields.key, false, true)\r\n        }))\r\n    },\r\n    _optionChanged: function(args) {\r\n        var {\r\n            name: name,\r\n            value: value,\r\n            previousValue: previousValue\r\n        } = args;\r\n        switch (name) {\r\n            case \"selectAllText\":\r\n                if (this._$selectAllItem) {\r\n                    this._$selectAllItem.dxCheckBox(\"instance\").option(\"text\", value)\r\n                }\r\n                break;\r\n            case \"showCheckBoxesMode\":\r\n                this._checkBoxModeChange(value, previousValue);\r\n                break;\r\n            case \"scrollDirection\":\r\n                this.getScrollable().option(\"direction\", value);\r\n                break;\r\n            case \"useNativeScrolling\":\r\n                this.getScrollable().option(\"useNative\", value);\r\n                break;\r\n            case \"items\":\r\n                delete this._$selectAllItem;\r\n                this.callBase(args);\r\n                break;\r\n            case \"dataSource\":\r\n                this.callBase(args);\r\n                this._initDataAdapter();\r\n                this._filter = {};\r\n                break;\r\n            case \"hasItemsExpr\":\r\n                this._initAccessors();\r\n                this.repaint();\r\n                break;\r\n            case \"expandEvent\":\r\n                this._initExpandEvent();\r\n                break;\r\n            case \"deferRendering\":\r\n            case \"dataStructure\":\r\n            case \"rootValue\":\r\n            case \"createChildren\":\r\n            case \"expandNodesRecursive\":\r\n            case \"onItemSelectionChanged\":\r\n            case \"onItemExpanded\":\r\n            case \"onItemCollapsed\":\r\n            case \"expandAllEnabled\":\r\n            case \"animationEnabled\":\r\n            case \"virtualModeEnabled\":\r\n            case \"selectByClick\":\r\n                break;\r\n            case \"selectionMode\":\r\n                this._initDataAdapter();\r\n                this.callBase(args);\r\n                break;\r\n            case \"onSelectAllValueChanged\":\r\n                this._createSelectAllValueChangedAction();\r\n                break;\r\n            case \"selectNodesRecursive\":\r\n                this._dataAdapter.setOption(\"recursiveSelection\", args.value);\r\n                this.repaint();\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    },\r\n    _initDataSource: function() {\r\n        if (this._useCustomChildrenLoader()) {\r\n            this._loadChildrenByCustomLoader(null).done(function(newItems) {\r\n                if (newItems && newItems.length) {\r\n                    this.option(\"items\", newItems)\r\n                }\r\n            }.bind(this))\r\n        } else {\r\n            this.callBase();\r\n            this._isVirtualMode() && this._initVirtualMode()\r\n        }\r\n    },\r\n    _initVirtualMode: function() {\r\n        var filter = this._filter;\r\n        if (!filter.custom) {\r\n            filter.custom = this._dataSource.filter()\r\n        }\r\n        if (!filter.internal) {\r\n            filter.internal = [this.option(\"parentIdExpr\"), this.option(\"rootValue\")]\r\n        }\r\n    },\r\n    _useCustomChildrenLoader: function() {\r\n        return isFunction(this.option(\"createChildren\")) && this._isDataStructurePlain()\r\n    },\r\n    _loadChildrenByCustomLoader: function(parentNode) {\r\n        var invocationResult = this.option(\"createChildren\").call(this, parentNode);\r\n        if (Array.isArray(invocationResult)) {\r\n            return (new Deferred).resolve(invocationResult).promise()\r\n        }\r\n        if (invocationResult && isFunction(invocationResult.then)) {\r\n            return fromPromise(invocationResult)\r\n        }\r\n        return (new Deferred).resolve([]).promise()\r\n    },\r\n    _combineFilter: function() {\r\n        if (!this._filter.custom || !this._filter.custom.length) {\r\n            return this._filter.internal\r\n        }\r\n        return [this._filter.custom, this._filter.internal]\r\n    },\r\n    _dataSourceLoadErrorHandler: function() {\r\n        this._renderEmptyMessage()\r\n    },\r\n    _init: function() {\r\n        this._filter = {};\r\n        this.callBase();\r\n        this._initStoreChangeHandlers()\r\n    },\r\n    _dataSourceChangedHandler: function(newItems) {\r\n        var items = this.option(\"items\");\r\n        if (this._initialized && this._isVirtualMode() && items.length) {\r\n            return\r\n        }\r\n        this.option(\"items\", newItems)\r\n    },\r\n    _removeTreeViewLoadIndicator: function() {\r\n        if (!this._treeViewLoadIndicator) {\r\n            return\r\n        }\r\n        this._treeViewLoadIndicator.remove();\r\n        this._treeViewLoadIndicator = null\r\n    },\r\n    _createTreeViewLoadIndicator: function() {\r\n        this._treeViewLoadIndicator = $(\"<div>\").addClass(LOAD_INDICATOR_CLASS);\r\n        this._createComponent(this._treeViewLoadIndicator, LoadIndicator, {});\r\n        return this._treeViewLoadIndicator\r\n    },\r\n    _dataSourceLoadingChangedHandler: function(isLoading) {\r\n        var resultFilter;\r\n        if (this._isVirtualMode()) {\r\n            resultFilter = this._combineFilter();\r\n            this._dataSource.filter(resultFilter)\r\n        }\r\n        if (isLoading && !this._dataSource.isLoaded()) {\r\n            this.option(\"items\", []);\r\n            var $wrapper = $(\"<div>\").addClass(LOAD_INDICATOR_WRAPPER_CLASS);\r\n            this._createTreeViewLoadIndicator().appendTo($wrapper);\r\n            this.itemsContainer().append($wrapper);\r\n            if (this._isVirtualMode() && this._dataSource.filter() !== resultFilter) {\r\n                this._dataSource.filter([])\r\n            }\r\n        } else {\r\n            this._removeTreeViewLoadIndicator()\r\n        }\r\n    },\r\n    _initStoreChangeHandlers: function() {\r\n        if (\"plain\" !== this.option(\"dataStructure\")) {\r\n            return\r\n        }\r\n        this._dataSource && this._dataSource.store().on(\"inserted\", newItem => {\r\n            this.option().items = this.option(\"items\").concat(newItem);\r\n            this._dataAdapter.addItem(newItem);\r\n            if (!this._dataAdapter.isFiltered(newItem)) {\r\n                return\r\n            }\r\n            this._updateLevel(this._parentIdGetter(newItem))\r\n        }).on(\"removed\", removedKey => {\r\n            var node = this._dataAdapter.getNodeByKey(removedKey);\r\n            if (isDefined(node)) {\r\n                this.option(\"items\")[this._dataAdapter.getIndexByKey(node.internalFields.key)] = 0;\r\n                this._markChildrenItemsToRemove(node);\r\n                this._removeItems();\r\n                this._dataAdapter.removeItem(removedKey);\r\n                this._updateLevel(this._parentIdGetter(node))\r\n            }\r\n        })\r\n    },\r\n    _markChildrenItemsToRemove: function(node) {\r\n        var keys = node.internalFields.childrenKeys;\r\n        each(keys, (_, key) => {\r\n            this.option(\"items\")[this._dataAdapter.getIndexByKey(key)] = 0;\r\n            this._markChildrenItemsToRemove(this._dataAdapter.getNodeByKey(key))\r\n        })\r\n    },\r\n    _removeItems: function() {\r\n        var items = extend(true, [], this.option(\"items\"));\r\n        var counter = 0;\r\n        each(items, (index, item) => {\r\n            if (!item) {\r\n                this.option(\"items\").splice(index - counter, 1);\r\n                counter++\r\n            }\r\n        })\r\n    },\r\n    _updateLevel: function(parentId) {\r\n        var $container = this._getContainerByParentKey(parentId);\r\n        this._renderItems($container, this._dataAdapter.getChildrenNodes(parentId))\r\n    },\r\n    _getOldContainer: function($itemElement) {\r\n        if ($itemElement.length) {\r\n            return $itemElement.children(\".\".concat(NODE_CONTAINER_CLASS))\r\n        }\r\n        var scrollable = this.getScrollable();\r\n        if (scrollable) {\r\n            return $(scrollable.content()).children()\r\n        }\r\n        return $()\r\n    },\r\n    _getContainerByParentKey: function(parentId) {\r\n        var node = this._dataAdapter.getNodeByKey(parentId);\r\n        var $itemElement = node ? this._getNodeElement(node) : [];\r\n        this._getOldContainer($itemElement).remove();\r\n        var $container = this._renderNodeContainer($itemElement);\r\n        if (this._isRootLevel(parentId)) {\r\n            var scrollable = this.getScrollable();\r\n            if (!scrollable) {\r\n                this._renderScrollableContainer()\r\n            }\r\n            $(scrollable.content()).append($container)\r\n        }\r\n        return $container\r\n    },\r\n    _isRootLevel: function(parentId) {\r\n        return parentId === this.option(\"rootValue\")\r\n    },\r\n    _getAccessors: function() {\r\n        var accessors = this.callBase();\r\n        accessors.push(\"hasItems\");\r\n        return accessors\r\n    },\r\n    _getDataAdapterOptions: function() {\r\n        return {\r\n            rootValue: this.option(\"rootValue\"),\r\n            multipleSelection: !this._isSingleSelection(),\r\n            recursiveSelection: this._isRecursiveSelection(),\r\n            recursiveExpansion: this.option(\"expandNodesRecursive\"),\r\n            selectionRequired: this.option(\"selectionRequired\"),\r\n            dataType: this.option(\"dataStructure\"),\r\n            sort: this._dataSource && this._dataSource.sort()\r\n        }\r\n    },\r\n    _initMarkup: function() {\r\n        this._renderScrollableContainer();\r\n        this._renderEmptyMessage(this._dataAdapter.getRootNodes());\r\n        this.callBase();\r\n        this.setAria(\"role\", \"tree\")\r\n    },\r\n    _renderContentImpl: function() {\r\n        var $nodeContainer = this._renderNodeContainer();\r\n        $(this.getScrollable().content()).append($nodeContainer);\r\n        if (!this.option(\"items\") || !this.option(\"items\").length) {\r\n            return\r\n        }\r\n        this._renderItems($nodeContainer, this._dataAdapter.getRootNodes());\r\n        this._initExpandEvent();\r\n        if (this._selectAllEnabled()) {\r\n            this._createSelectAllValueChangedAction();\r\n            this._renderSelectAllItem($nodeContainer)\r\n        }\r\n    },\r\n    _isVirtualMode: function() {\r\n        return this.option(\"virtualModeEnabled\") && this._isDataStructurePlain() && !!this.option(\"dataSource\")\r\n    },\r\n    _isDataStructurePlain: function() {\r\n        return \"plain\" === this.option(\"dataStructure\")\r\n    },\r\n    _fireContentReadyAction: function() {\r\n        var dataSource = this.getDataSource();\r\n        var skipContentReadyAction = dataSource && !dataSource.isLoaded();\r\n        var scrollable = this.getScrollable();\r\n        if (scrollable && hasWindow()) {\r\n            scrollable.update()\r\n        }\r\n        if (!skipContentReadyAction) {\r\n            this.callBase()\r\n        }\r\n        if (scrollable && hasWindow()) {\r\n            scrollable.update()\r\n        }\r\n    },\r\n    _renderScrollableContainer: function() {\r\n        this._scrollable = this._createComponent($(\"<div>\").appendTo(this.$element()), Scrollable, {\r\n            useNative: this.option(\"useNativeScrolling\"),\r\n            direction: this.option(\"scrollDirection\"),\r\n            useKeyboard: false\r\n        })\r\n    },\r\n    _renderNodeContainer: function($parent) {\r\n        var $container = $(\"<ul>\").addClass(NODE_CONTAINER_CLASS);\r\n        this.setAria(\"role\", \"group\", $container);\r\n        if ($parent && $parent.length) {\r\n            var itemData = this._getItemData($parent.children(\".\" + ITEM_CLASS));\r\n            if (this._expandedGetter(itemData)) {\r\n                $container.addClass(OPENED_NODE_CONTAINER_CLASS)\r\n            }\r\n            $container.appendTo($parent)\r\n        }\r\n        return $container\r\n    },\r\n    _createDOMElement: function($nodeContainer, node) {\r\n        var $node = $(\"<li>\").addClass(NODE_CLASS).attr(DATA_ITEM_ID, this._encodeString(node.internalFields.key)).prependTo($nodeContainer);\r\n        this.setAria({\r\n            role: \"treeitem\",\r\n            label: this._displayGetter(node.internalFields.item) || \"\",\r\n            expanded: node.internalFields.expanded || false,\r\n            level: this._getLevel($nodeContainer)\r\n        }, $node);\r\n        return $node\r\n    },\r\n    _getLevel: function($nodeContainer) {\r\n        var parent = $nodeContainer.parent();\r\n        return parent.hasClass(\"dx-scrollable-content\") ? 1 : parseInt(parent.attr(\"aria-level\")) + 1\r\n    },\r\n    _showCheckboxes: function() {\r\n        return \"none\" !== this.option(\"showCheckBoxesMode\")\r\n    },\r\n    _selectAllEnabled: function() {\r\n        return \"selectAll\" === this.option(\"showCheckBoxesMode\") && !this._isSingleSelection()\r\n    },\r\n    _renderItems: function($nodeContainer, nodes) {\r\n        var length = nodes.length - 1;\r\n        for (var i = length; i >= 0; i--) {\r\n            this._renderItem(i, nodes[i], $nodeContainer)\r\n        }\r\n        this._renderedItemsCount += nodes.length\r\n    },\r\n    _renderItem: function(nodeIndex, node, $nodeContainer) {\r\n        var $node = this._createDOMElement($nodeContainer, node);\r\n        var nodeData = node.internalFields;\r\n        var showCheckBox = this._showCheckboxes();\r\n        $node.addClass(showCheckBox ? ITEM_WITH_CHECKBOX_CLASS : ITEM_WITHOUT_CHECKBOX_CLASS);\r\n        $node.toggleClass(INVISIBLE_STATE_CLASS, false === nodeData.item.visible);\r\n        showCheckBox && this._renderCheckBox($node, node);\r\n        this.setAria(\"selected\", nodeData.selected, $node);\r\n        this._toggleSelectedClass($node, nodeData.selected);\r\n        this.callBase(this._renderedItemsCount + nodeIndex, nodeData.item, $node);\r\n        if (false !== nodeData.item.visible) {\r\n            this._renderChildren($node, node)\r\n        }\r\n    },\r\n    _setAriaSelected: function() {},\r\n    _renderChildren: function($node, node) {\r\n        if (!this._hasChildren(node)) {\r\n            this._addLeafClass($node);\r\n            return\r\n        }\r\n        this._renderToggleItemVisibilityIcon($node, node);\r\n        if (this.option(\"deferRendering\") && !node.internalFields.expanded) {\r\n            return\r\n        }\r\n        this._loadSublevel(node).done(childNodes => {\r\n            this._renderSublevel($node, this._getActualNode(node), childNodes)\r\n        })\r\n    },\r\n    _getActualNode: function(cachedNode) {\r\n        return this._dataAdapter.getNodeByKey(cachedNode.internalFields.key)\r\n    },\r\n    _hasChildren: function(node) {\r\n        if (this._isVirtualMode() || this._useCustomChildrenLoader()) {\r\n            return false !== this._hasItemsGetter(node.internalFields.item)\r\n        }\r\n        return this.callBase(node)\r\n    },\r\n    _loadSublevel: function(node) {\r\n        var deferred = new Deferred;\r\n        var childrenNodes = this._getChildNodes(node);\r\n        if (childrenNodes.length) {\r\n            deferred.resolve(childrenNodes)\r\n        } else {\r\n            this._loadNestedItems(node).done(items => {\r\n                deferred.resolve(this._dataAdapter.getNodesByItems(items))\r\n            })\r\n        }\r\n        return deferred.promise()\r\n    },\r\n    _renderSublevel: function($node, node, childNodes) {\r\n        var $nestedNodeContainer = this._renderNodeContainer($node, node);\r\n        var childNodesByChildrenKeys = childNodes.filter(childNode => -1 !== node.internalFields.childrenKeys.indexOf(childNode.internalFields.key));\r\n        this._renderItems($nestedNodeContainer, childNodesByChildrenKeys);\r\n        if (childNodesByChildrenKeys.length && !node.internalFields.selected) {\r\n            var firstChild = childNodesByChildrenKeys[0];\r\n            this._updateParentsState(firstChild, this._getNodeElement(firstChild))\r\n        }\r\n        this._normalizeIconState($node, childNodesByChildrenKeys.length);\r\n        if (node.internalFields.expanded) {\r\n            $nestedNodeContainer.addClass(OPENED_NODE_CONTAINER_CLASS)\r\n        }\r\n    },\r\n    _executeItemRenderAction: function(itemIndex, itemData, itemElement) {\r\n        var node = this._getNode(itemElement);\r\n        this._getItemRenderAction()({\r\n            itemElement: itemElement,\r\n            itemIndex: itemIndex,\r\n            itemData: itemData,\r\n            node: this._dataAdapter.getPublicNode(node)\r\n        })\r\n    },\r\n    _addLeafClass: function($node) {\r\n        $node.addClass(IS_LEAF)\r\n    },\r\n    _expandEventHandler: function(e) {\r\n        var $nodeElement = $(e.currentTarget.parentNode);\r\n        if (!$nodeElement.hasClass(IS_LEAF)) {\r\n            this._toggleExpandedState(e.currentTarget, void 0, e)\r\n        }\r\n    },\r\n    _initExpandEvent: function() {\r\n        var expandedEventName = this._getEventNameByOption(this.option(\"expandEvent\"));\r\n        var $itemsContainer = this._itemContainer();\r\n        var itemSelector = this._itemSelector();\r\n        eventsEngine.off($itemsContainer, \".\" + EXPAND_EVENT_NAMESPACE, itemSelector);\r\n        eventsEngine.on($itemsContainer, expandedEventName, itemSelector, this._expandEventHandler.bind(this))\r\n    },\r\n    _getEventNameByOption: function(name) {\r\n        var event = \"click\" === name ? clickEventName : dblclickEvent;\r\n        return addNamespace(event, EXPAND_EVENT_NAMESPACE)\r\n    },\r\n    _getNode: function(identifier) {\r\n        if (!isDefined(identifier)) {\r\n            return null\r\n        }\r\n        if (identifier.internalFields) {\r\n            return identifier\r\n        }\r\n        if (isPrimitive(identifier)) {\r\n            return this._dataAdapter.getNodeByKey(identifier)\r\n        }\r\n        var itemElement = $(identifier).get(0);\r\n        if (!itemElement) {\r\n            return null\r\n        }\r\n        if (domAdapter.isElementNode(itemElement)) {\r\n            return this._getNodeByElement(itemElement)\r\n        }\r\n        return this._dataAdapter.getNodeByItem(itemElement)\r\n    },\r\n    _getNodeByElement: function(itemElement) {\r\n        var $node = $(itemElement).closest(\".\" + NODE_CLASS);\r\n        var key = this._decodeString($node.attr(DATA_ITEM_ID));\r\n        return this._dataAdapter.getNodeByKey(key)\r\n    },\r\n    _toggleExpandedState: function(itemElement, state, e) {\r\n        var node = this._getNode(itemElement);\r\n        if (!node) {\r\n            return (new Deferred).reject().promise()\r\n        }\r\n        if (node.internalFields.disabled) {\r\n            return (new Deferred).reject().promise()\r\n        }\r\n        var currentState = node.internalFields.expanded;\r\n        if (currentState === state) {\r\n            return (new Deferred).resolve().promise()\r\n        }\r\n        if (this._hasChildren(node)) {\r\n            var $node = this._getNodeElement(node);\r\n            if ($node.find(\".\".concat(NODE_LOAD_INDICATOR_CLASS, \":not(.\").concat(INVISIBLE_STATE_CLASS, \")\")).length) {\r\n                return (new Deferred).reject().promise()\r\n            }\r\n            this._createLoadIndicator($node)\r\n        }\r\n        if (!isDefined(state)) {\r\n            state = !currentState\r\n        }\r\n        this._dataAdapter.toggleExpansion(node.internalFields.key, state);\r\n        return this._updateExpandedItemsUI(node, state, e)\r\n    },\r\n    _createLoadIndicator: function($node) {\r\n        var $icon = $node.children(\".\" + TOGGLE_ITEM_VISIBILITY_CLASS);\r\n        var $nodeContainer = $node.children(\".\".concat(NODE_CONTAINER_CLASS));\r\n        if ($icon.hasClass(TOGGLE_ITEM_VISIBILITY_OPENED_CLASS) || $nodeContainer.not(\":empty\").length) {\r\n            return\r\n        }\r\n        this._createComponent($(\"<div>\").addClass(NODE_LOAD_INDICATOR_CLASS), LoadIndicator, {}).$element().appendTo($node);\r\n        $icon.hide()\r\n    },\r\n    _renderToggleItemVisibilityIcon: function($node, node) {\r\n        var $icon = $(\"<div>\").addClass(TOGGLE_ITEM_VISIBILITY_CLASS).appendTo($node);\r\n        if (node.internalFields.expanded) {\r\n            $icon.addClass(TOGGLE_ITEM_VISIBILITY_OPENED_CLASS);\r\n            $node.parent().addClass(OPENED_NODE_CONTAINER_CLASS)\r\n        }\r\n        if (node.internalFields.disabled) {\r\n            $icon.addClass(DISABLED_STATE_CLASS)\r\n        }\r\n        this._renderToggleItemVisibilityIconClick($icon, node)\r\n    },\r\n    _renderToggleItemVisibilityIconClick: function($icon, node) {\r\n        var eventName = addNamespace(clickEventName, this.NAME);\r\n        eventsEngine.off($icon, eventName);\r\n        eventsEngine.on($icon, eventName, e => {\r\n            this._toggleExpandedState(node.internalFields.key, void 0, e)\r\n        })\r\n    },\r\n    _updateExpandedItemsUI: function(node, state, e) {\r\n        var $node = this._getNodeElement(node);\r\n        var isHiddenNode = !$node.length || state && $node.is(\":hidden\");\r\n        if (this.option(\"expandNodesRecursive\") && isHiddenNode) {\r\n            var parentNode = this._getNode(node.internalFields.parentKey);\r\n            if (parentNode) {\r\n                this._updateExpandedItemsUI(parentNode, state, e)\r\n            }\r\n        }\r\n        var $icon = $node.children(\".\" + TOGGLE_ITEM_VISIBILITY_CLASS);\r\n        var $nodeContainer = $node.children(\".\".concat(NODE_CONTAINER_CLASS));\r\n        $icon.toggleClass(TOGGLE_ITEM_VISIBILITY_OPENED_CLASS, state);\r\n        var nodeContainerExists = $nodeContainer.length > 0;\r\n        var completionCallback = new Deferred;\r\n        if (!state || nodeContainerExists && !$nodeContainer.is(\":empty\")) {\r\n            this._animateNodeContainer(node, state, e, completionCallback);\r\n            return completionCallback.promise()\r\n        }\r\n        if (0 === node.internalFields.childrenKeys.length && (this._isVirtualMode() || this._useCustomChildrenLoader())) {\r\n            this._loadNestedItemsWithUpdate(node, state, e, completionCallback);\r\n            return completionCallback.promise()\r\n        }\r\n        this._renderSublevel($node, node, this._getChildNodes(node));\r\n        this._fireContentReadyAction();\r\n        this._animateNodeContainer(node, state, e, completionCallback);\r\n        return completionCallback.promise()\r\n    },\r\n    _loadNestedItemsWithUpdate: function(node, state, e, completionCallback) {\r\n        var $node = this._getNodeElement(node);\r\n        this._loadNestedItems(node).done(items => {\r\n            var actualNodeData = this._getActualNode(node);\r\n            this._renderSublevel($node, actualNodeData, this._dataAdapter.getNodesByItems(items));\r\n            if (!items || !items.length) {\r\n                return\r\n            }\r\n            this._fireContentReadyAction();\r\n            this._animateNodeContainer(actualNodeData, state, e, completionCallback)\r\n        })\r\n    },\r\n    _loadNestedItems: function(node) {\r\n        if (this._useCustomChildrenLoader()) {\r\n            var publicNode = this._dataAdapter.getPublicNode(node);\r\n            return this._loadChildrenByCustomLoader(publicNode).done(newItems => {\r\n                if (!this._areNodesExists(newItems)) {\r\n                    this._appendItems(newItems)\r\n                }\r\n            })\r\n        }\r\n        if (!this._isVirtualMode()) {\r\n            return (new Deferred).resolve([]).promise()\r\n        }\r\n        this._filter.internal = [this.option(\"parentIdExpr\"), node.internalFields.key];\r\n        this._dataSource.filter(this._combineFilter());\r\n        return this._dataSource.load().done(newItems => {\r\n            if (!this._areNodesExists(newItems)) {\r\n                this._appendItems(newItems)\r\n            }\r\n        })\r\n    },\r\n    _areNodesExists: function(newItems, items) {\r\n        var keyOfRootItem = this.keyOf(newItems[0]);\r\n        var fullData = this._dataAdapter.getFullData();\r\n        return !!this._dataAdapter.getNodeByKey(keyOfRootItem, fullData)\r\n    },\r\n    _appendItems: function(newItems) {\r\n        this.option().items = this.option(\"items\").concat(newItems);\r\n        this._initDataAdapter()\r\n    },\r\n    _animateNodeContainer: function(node, state, e, completionCallback) {\r\n        var $node = this._getNodeElement(node);\r\n        var $nodeContainer = $node.children(\".\".concat(NODE_CONTAINER_CLASS));\r\n        if (node && completionCallback && 0 === $nodeContainer.length) {\r\n            completionCallback.resolve()\r\n        }\r\n        $nodeContainer.addClass(OPENED_NODE_CONTAINER_CLASS);\r\n        var nodeHeight = getHeight($nodeContainer);\r\n        fx.stop($nodeContainer, true);\r\n        fx.animate($nodeContainer, {\r\n            type: \"custom\",\r\n            duration: this.option(\"animationEnabled\") ? 400 : 0,\r\n            from: {\r\n                maxHeight: state ? 0 : nodeHeight\r\n            },\r\n            to: {\r\n                maxHeight: state ? nodeHeight : 0\r\n            },\r\n            complete: function() {\r\n                $nodeContainer.css(\"maxHeight\", \"none\");\r\n                $nodeContainer.toggleClass(OPENED_NODE_CONTAINER_CLASS, state);\r\n                this.setAria(\"expanded\", state, $node);\r\n                this.getScrollable().update();\r\n                this._fireExpandedStateUpdatedEvent(state, node, e);\r\n                if (completionCallback) {\r\n                    completionCallback.resolve()\r\n                }\r\n            }.bind(this)\r\n        })\r\n    },\r\n    _fireExpandedStateUpdatedEvent: function(isExpanded, node, e) {\r\n        if (!this._hasChildren(node)) {\r\n            return\r\n        }\r\n        var optionName = isExpanded ? \"onItemExpanded\" : \"onItemCollapsed\";\r\n        if (isDefined(e)) {\r\n            this._itemDXEventHandler(e, optionName, {\r\n                node: this._dataAdapter.getPublicNode(node)\r\n            })\r\n        } else {\r\n            var target = this._getNodeElement(node);\r\n            this._itemEventHandler(target, optionName, {\r\n                event: e,\r\n                node: this._dataAdapter.getPublicNode(node)\r\n            })\r\n        }\r\n    },\r\n    _normalizeIconState: function($node, hasNewItems) {\r\n        var $loadIndicator = $node.find(\".\".concat(NODE_LOAD_INDICATOR_CLASS));\r\n        $loadIndicator.length && LoadIndicator.getInstance($loadIndicator).option(\"visible\", false);\r\n        if (hasNewItems) {\r\n            var $icon = $node.find(\".\" + TOGGLE_ITEM_VISIBILITY_CLASS);\r\n            $icon.show();\r\n            return\r\n        }\r\n        $node.find(\".\" + TOGGLE_ITEM_VISIBILITY_CLASS).removeClass(TOGGLE_ITEM_VISIBILITY_CLASS);\r\n        $node.addClass(IS_LEAF)\r\n    },\r\n    _emptyMessageContainer: function() {\r\n        var scrollable = this.getScrollable();\r\n        return scrollable ? $(scrollable.content()) : this.callBase()\r\n    },\r\n    _renderContent: function() {\r\n        var items = this.option(\"items\");\r\n        if (items && items.length) {\r\n            this._contentAlreadyRendered = true\r\n        }\r\n        this.callBase()\r\n    },\r\n    _renderSelectAllItem: function($container) {\r\n        $container = $container || this.$element().find(\".\".concat(NODE_CONTAINER_CLASS)).first();\r\n        this._$selectAllItem = $(\"<div>\").addClass(SELECT_ALL_ITEM_CLASS);\r\n        var value = this._dataAdapter.isAllSelected();\r\n        this._createComponent(this._$selectAllItem, CheckBox, {\r\n            value: value,\r\n            text: this.option(\"selectAllText\"),\r\n            onValueChanged: this._onSelectAllCheckboxValueChanged.bind(this)\r\n        });\r\n        this._toggleSelectedClass(this._$selectAllItem, value);\r\n        $container.before(this._$selectAllItem)\r\n    },\r\n    _onSelectAllCheckboxValueChanged: function(args) {\r\n        this._toggleSelectAll(args);\r\n        this._fireSelectAllValueChanged(args.value)\r\n    },\r\n    _toggleSelectAll: function(args) {\r\n        this._dataAdapter.toggleSelectAll(args.value);\r\n        this._updateItemsUI();\r\n        this._fireSelectionChanged()\r\n    },\r\n    _renderCheckBox: function($node, node) {\r\n        var $checkbox = $(\"<div>\").appendTo($node);\r\n        this._createComponent($checkbox, CheckBox, {\r\n            value: node.internalFields.selected,\r\n            onValueChanged: this._changeCheckboxValue.bind(this),\r\n            focusStateEnabled: false,\r\n            disabled: this._disabledGetter(node)\r\n        })\r\n    },\r\n    _toggleSelectedClass: function($node, value) {\r\n        $node.toggleClass(SELECTED_ITEM_CLASS, !!value)\r\n    },\r\n    _toggleNodeDisabledState: function(node, state) {\r\n        var $node = this._getNodeElement(node);\r\n        var $item = $node.find(\".\" + ITEM_CLASS).eq(0);\r\n        this._dataAdapter.toggleNodeDisabledState(node.internalFields.key, state);\r\n        $item.toggleClass(DISABLED_STATE_CLASS, !!state);\r\n        if (this._showCheckboxes()) {\r\n            var checkbox = this._getCheckBoxInstance($node);\r\n            checkbox.option(\"disabled\", !!state)\r\n        }\r\n    },\r\n    _itemOptionChanged: function(item, property, value) {\r\n        var node = this._dataAdapter.getNodeByItem(item);\r\n        if (property === this.option(\"disabledExpr\")) {\r\n            this._toggleNodeDisabledState(node, value)\r\n        }\r\n    },\r\n    _changeCheckboxValue: function(e) {\r\n        var $node = $(e.element).parent(\".\" + NODE_CLASS);\r\n        var $item = $node.children(\".\" + ITEM_CLASS);\r\n        var item = this._getItemData($item);\r\n        var node = this._getNodeByElement($item);\r\n        var value = e.value;\r\n        if (node && node.internalFields.selected === value) {\r\n            return\r\n        }\r\n        this._updateItemSelection(value, item, e.event)\r\n    },\r\n    _isSingleSelection: function() {\r\n        return \"single\" === this.option(\"selectionMode\")\r\n    },\r\n    _isRecursiveSelection: function() {\r\n        return this.option(\"selectNodesRecursive\") && \"single\" !== this.option(\"selectionMode\")\r\n    },\r\n    _isLastSelectedBranch: function(publicNode, selectedNodesKeys, deep) {\r\n        var keyIndex = selectedNodesKeys.indexOf(publicNode.key);\r\n        if (keyIndex >= 0) {\r\n            selectedNodesKeys.splice(keyIndex, 1)\r\n        }\r\n        if (deep) {\r\n            each(publicNode.children, function(_, childNode) {\r\n                this._isLastSelectedBranch(childNode, selectedNodesKeys, true)\r\n            }.bind(this))\r\n        }\r\n        if (publicNode.parent) {\r\n            this._isLastSelectedBranch(publicNode.parent, selectedNodesKeys)\r\n        }\r\n        return 0 === selectedNodesKeys.length\r\n    },\r\n    _isLastRequired: function(node) {\r\n        var selectionRequired = this.option(\"selectionRequired\");\r\n        var isSingleMode = this._isSingleSelection();\r\n        var selectedNodesKeys = this.getSelectedNodeKeys();\r\n        if (!selectionRequired) {\r\n            return\r\n        }\r\n        if (isSingleMode) {\r\n            return 1 === selectedNodesKeys.length\r\n        } else {\r\n            return this._isLastSelectedBranch(node.internalFields.publicNode, selectedNodesKeys.slice(), true)\r\n        }\r\n    },\r\n    _updateItemSelection: function(value, itemElement, dxEvent) {\r\n        var node = this._getNode(itemElement);\r\n        if (!node || false === node.visible) {\r\n            return false\r\n        }\r\n        if (node.internalFields.selected === value) {\r\n            return true\r\n        }\r\n        if (!value && this._isLastRequired(node)) {\r\n            if (this._showCheckboxes()) {\r\n                var $node = this._getNodeElement(node);\r\n                this._getCheckBoxInstance($node).option(\"value\", true)\r\n            }\r\n            return false\r\n        }\r\n        if (value && this._isSingleSelection()) {\r\n            var selectedKeys = this.getSelectedNodeKeys();\r\n            each(selectedKeys, (index, key) => {\r\n                this._dataAdapter.toggleSelection(key, false);\r\n                this._updateItemsUI();\r\n                this._fireItemSelectionChanged(this._getNode(key))\r\n            })\r\n        }\r\n        this._dataAdapter.toggleSelection(node.internalFields.key, value);\r\n        var isAllSelected = this._dataAdapter.isAllSelected();\r\n        var needFireSelectAllChanged = this._selectAllEnabled() && this._$selectAllItem.dxCheckBox(\"instance\").option(\"value\") !== isAllSelected;\r\n        this._updateItemsUI();\r\n        this._fireItemSelectionChanged(node, dxEvent);\r\n        this._fireSelectionChanged();\r\n        if (needFireSelectAllChanged) {\r\n            this._fireSelectAllValueChanged(isAllSelected)\r\n        }\r\n        return true\r\n    },\r\n    _fireItemSelectionChanged: function(node, dxEvent) {\r\n        var initiator = dxEvent || this._findItemElementByItem(node.internalFields.item);\r\n        var handler = dxEvent ? this._itemDXEventHandler : this._itemEventHandler;\r\n        handler.call(this, initiator, \"onItemSelectionChanged\", {\r\n            node: this._dataAdapter.getPublicNode(node),\r\n            itemData: node.internalFields.item\r\n        })\r\n    },\r\n    _getCheckBoxInstance: function($node) {\r\n        return $node.children(\".dx-checkbox\").dxCheckBox(\"instance\")\r\n    },\r\n    _updateItemsUI: function() {\r\n        var cache = {};\r\n        each(this._dataAdapter.getData(), (_, node) => {\r\n            var $node = this._getNodeElement(node, cache);\r\n            var nodeSelection = node.internalFields.selected;\r\n            if (!$node.length) {\r\n                return\r\n            }\r\n            this._toggleSelectedClass($node, nodeSelection);\r\n            this.setAria(\"selected\", nodeSelection, $node);\r\n            if (this._showCheckboxes()) {\r\n                this._getCheckBoxInstance($node).option(\"value\", nodeSelection)\r\n            }\r\n        });\r\n        if (this._selectAllEnabled()) {\r\n            var selectAllCheckbox = this._$selectAllItem.dxCheckBox(\"instance\");\r\n            selectAllCheckbox.option(\"onValueChanged\", void 0);\r\n            selectAllCheckbox.option(\"value\", this._dataAdapter.isAllSelected());\r\n            selectAllCheckbox.option(\"onValueChanged\", this._onSelectAllCheckboxValueChanged.bind(this))\r\n        }\r\n    },\r\n    _updateParentsState: function(node, $node) {\r\n        if (!$node) {\r\n            return\r\n        }\r\n        var parentNode = this._dataAdapter.getNodeByKey(node.internalFields.parentKey);\r\n        var $parentNode = $($node.parents(\".\" + NODE_CLASS)[0]);\r\n        if (this._showCheckboxes()) {\r\n            var parentValue = parentNode.internalFields.selected;\r\n            this._getCheckBoxInstance($parentNode).option(\"value\", parentValue);\r\n            this._toggleSelectedClass($parentNode, parentValue)\r\n        }\r\n        if (parentNode.internalFields.parentKey !== this.option(\"rootValue\")) {\r\n            this._updateParentsState(parentNode, $parentNode)\r\n        }\r\n    },\r\n    _itemEventHandlerImpl: function(initiator, action, actionArgs) {\r\n        var $itemElement = $(initiator).closest(\".\" + NODE_CLASS).children(\".\" + ITEM_CLASS);\r\n        return action(extend(this._extendActionArgs($itemElement), actionArgs))\r\n    },\r\n    _itemContextMenuHandler: function(e) {\r\n        this._createEventHandler(\"onItemContextMenu\", e)\r\n    },\r\n    _itemHoldHandler: function(e) {\r\n        this._createEventHandler(\"onItemHold\", e)\r\n    },\r\n    _createEventHandler: function(eventName, e) {\r\n        var node = this._getNodeByElement(e.currentTarget);\r\n        this._itemDXEventHandler(e, eventName, {\r\n            node: this._dataAdapter.getPublicNode(node)\r\n        })\r\n    },\r\n    _itemClass: function() {\r\n        return ITEM_CLASS\r\n    },\r\n    _itemDataKey: function() {\r\n        return ITEM_DATA_KEY\r\n    },\r\n    _attachClickEvent: function() {\r\n        var clickSelector = \".\" + this._itemClass();\r\n        var pointerDownSelector = \".\" + NODE_CLASS + \", .\" + SELECT_ALL_ITEM_CLASS;\r\n        var eventName = addNamespace(clickEventName, this.NAME);\r\n        var pointerDownEvent = addNamespace(pointerEvents.down, this.NAME);\r\n        var $itemContainer = this._itemContainer();\r\n        var that = this;\r\n        eventsEngine.off($itemContainer, eventName, clickSelector);\r\n        eventsEngine.off($itemContainer, pointerDownEvent, pointerDownSelector);\r\n        eventsEngine.on($itemContainer, eventName, clickSelector, (function(e) {\r\n            that._itemClickHandler(e, $(this))\r\n        }));\r\n        eventsEngine.on($itemContainer, pointerDownEvent, pointerDownSelector, (function(e) {\r\n            that._itemPointerDownHandler(e)\r\n        }))\r\n    },\r\n    _itemClickHandler: function(e, $item) {\r\n        var itemData = this._getItemData($item);\r\n        var node = this._getNodeByElement($item);\r\n        this._itemDXEventHandler(e, \"onItemClick\", {\r\n            node: this._dataAdapter.getPublicNode(node)\r\n        });\r\n        if (this.option(\"selectByClick\") && !e.isDefaultPrevented()) {\r\n            this._updateItemSelection(!node.internalFields.selected, itemData, e)\r\n        }\r\n    },\r\n    _updateSelectionToFirstItem: function($items, startIndex) {\r\n        var itemIndex = startIndex;\r\n        while (itemIndex >= 0) {\r\n            var $item = $($items[itemIndex]);\r\n            this._updateItemSelection(true, $item.find(\".\" + ITEM_CLASS).get(0));\r\n            itemIndex--\r\n        }\r\n    },\r\n    _updateSelectionToLastItem: function($items, startIndex) {\r\n        var length = $items.length;\r\n        var itemIndex = startIndex;\r\n        while (itemIndex < length) {\r\n            var $item = $($items[itemIndex]);\r\n            this._updateItemSelection(true, $item.find(\".\" + ITEM_CLASS).get(0));\r\n            itemIndex++\r\n        }\r\n    },\r\n    _focusInHandler: function(e) {\r\n        this._updateFocusState(e, true);\r\n        if (this.option(\"focusedElement\")) {\r\n            clearTimeout(this._setFocusedItemTimeout);\r\n            this._setFocusedItemTimeout = setTimeout(() => {\r\n                this._setFocusedItem($(this.option(\"focusedElement\")))\r\n            });\r\n            return\r\n        }\r\n        var $activeItem = this._getActiveItem();\r\n        this.option(\"focusedElement\", getPublicElement($activeItem.closest(\".\" + NODE_CLASS)))\r\n    },\r\n    _setFocusedItem: function($target) {\r\n        if (!$target || !$target.length) {\r\n            return\r\n        }\r\n        if (!$target.children().hasClass(DISABLED_STATE_CLASS)) {\r\n            this.callBase($target)\r\n        }\r\n    },\r\n    _itemPointerDownHandler: function(e) {\r\n        if (!this.option(\"focusStateEnabled\")) {\r\n            return\r\n        }\r\n        var $target = $(e.target).closest(\".\" + NODE_CLASS + \", .\" + SELECT_ALL_ITEM_CLASS);\r\n        if (!$target.length) {\r\n            return\r\n        }\r\n        var itemElement = $target.hasClass(DISABLED_STATE_CLASS) ? null : $target;\r\n        this.option(\"focusedElement\", getPublicElement(itemElement))\r\n    },\r\n    _findNonDisabledNodes: function($nodes) {\r\n        return $nodes.not((function() {\r\n            return $(this).children(\".\" + ITEM_CLASS).hasClass(DISABLED_STATE_CLASS)\r\n        }))\r\n    },\r\n    _moveFocus: function(location, e) {\r\n        var FOCUS_UP = \"up\";\r\n        var FOCUS_DOWN = \"down\";\r\n        var FOCUS_FIRST = \"first\";\r\n        var FOCUS_LAST = \"last\";\r\n        var FOCUS_LEFT = this.option(\"rtlEnabled\") ? \"right\" : \"left\";\r\n        var FOCUS_RIGHT = this.option(\"rtlEnabled\") ? \"left\" : \"right\";\r\n        this.$element().find(\".\".concat(NODE_CONTAINER_CLASS)).each((function() {\r\n            fx.stop(this, true)\r\n        }));\r\n        var $items = this._findNonDisabledNodes(this._nodeElements());\r\n        if (!$items || !$items.length) {\r\n            return\r\n        }\r\n        switch (location) {\r\n            case FOCUS_UP:\r\n                var $prevItem = this._prevItem($items);\r\n                this.option(\"focusedElement\", getPublicElement($prevItem));\r\n                var prevItemElement = this._getNodeItemElement($prevItem);\r\n                this.getScrollable().scrollToElement(prevItemElement);\r\n                if (e.shiftKey && this._showCheckboxes()) {\r\n                    this._updateItemSelection(true, prevItemElement)\r\n                }\r\n                break;\r\n            case FOCUS_DOWN:\r\n                var $nextItem = this._nextItem($items);\r\n                this.option(\"focusedElement\", getPublicElement($nextItem));\r\n                var nextItemElement = this._getNodeItemElement($nextItem);\r\n                this.getScrollable().scrollToElement(nextItemElement);\r\n                if (e.shiftKey && this._showCheckboxes()) {\r\n                    this._updateItemSelection(true, nextItemElement)\r\n                }\r\n                break;\r\n            case FOCUS_FIRST:\r\n                var $firstItem = $items.first();\r\n                if (e.shiftKey && this._showCheckboxes()) {\r\n                    this._updateSelectionToFirstItem($items, $items.index(this._prevItem($items)))\r\n                }\r\n                this.option(\"focusedElement\", getPublicElement($firstItem));\r\n                this.getScrollable().scrollToElement(this._getNodeItemElement($firstItem));\r\n                break;\r\n            case FOCUS_LAST:\r\n                var $lastItem = $items.last();\r\n                if (e.shiftKey && this._showCheckboxes()) {\r\n                    this._updateSelectionToLastItem($items, $items.index(this._nextItem($items)))\r\n                }\r\n                this.option(\"focusedElement\", getPublicElement($lastItem));\r\n                this.getScrollable().scrollToElement(this._getNodeItemElement($lastItem));\r\n                break;\r\n            case FOCUS_RIGHT:\r\n                this._expandFocusedContainer();\r\n                break;\r\n            case FOCUS_LEFT:\r\n                this._collapseFocusedContainer();\r\n                break;\r\n            default:\r\n                this.callBase.apply(this, arguments);\r\n                return\r\n        }\r\n    },\r\n    _getNodeItemElement: function($node) {\r\n        return $node.find(\".\" + ITEM_CLASS).get(0)\r\n    },\r\n    _nodeElements: function() {\r\n        return this.$element().find(\".\" + NODE_CLASS).not(\":hidden\")\r\n    },\r\n    _expandFocusedContainer: function() {\r\n        var $focusedNode = $(this.option(\"focusedElement\"));\r\n        if (!$focusedNode.length || $focusedNode.hasClass(IS_LEAF)) {\r\n            return\r\n        }\r\n        var $node = $focusedNode.find(\".\".concat(NODE_CONTAINER_CLASS)).eq(0);\r\n        if ($node.hasClass(OPENED_NODE_CONTAINER_CLASS)) {\r\n            var $nextItem = this._nextItem(this._findNonDisabledNodes(this._nodeElements()));\r\n            this.option(\"focusedElement\", getPublicElement($nextItem));\r\n            this.getScrollable().scrollToElement(this._getNodeItemElement($nextItem));\r\n            return\r\n        }\r\n        var node = this._getNodeByElement($focusedNode.children(\".\" + ITEM_CLASS));\r\n        this._toggleExpandedState(node, true)\r\n    },\r\n    _getClosestNonDisabledNode: function($node) {\r\n        do {\r\n            $node = $node.parent().closest(\".\" + NODE_CLASS)\r\n        } while ($node.children(\".dx-treeview-item.dx-state-disabled\").length);\r\n        return $node\r\n    },\r\n    _collapseFocusedContainer: function() {\r\n        var $focusedNode = $(this.option(\"focusedElement\"));\r\n        if (!$focusedNode.length) {\r\n            return\r\n        }\r\n        var nodeElement = $focusedNode.find(\".\".concat(NODE_CONTAINER_CLASS)).eq(0);\r\n        if (!$focusedNode.hasClass(IS_LEAF) && nodeElement.hasClass(OPENED_NODE_CONTAINER_CLASS)) {\r\n            var node = this._getNodeByElement($focusedNode.children(\".\" + ITEM_CLASS));\r\n            this._toggleExpandedState(node, false)\r\n        } else {\r\n            var collapsedNode = this._getClosestNonDisabledNode($focusedNode);\r\n            collapsedNode.length && this.option(\"focusedElement\", getPublicElement(collapsedNode));\r\n            this.getScrollable().scrollToElement(this._getNodeItemElement(collapsedNode))\r\n        }\r\n    },\r\n    _encodeString: function(value) {\r\n        return isString(value) ? encodeURI(value) : value\r\n    },\r\n    _decodeString: function(value) {\r\n        return isString(value) ? decodeURI(value) : value\r\n    },\r\n    getScrollable: function() {\r\n        return this._scrollable\r\n    },\r\n    updateDimensions: function() {\r\n        var deferred = new Deferred;\r\n        var scrollable = this.getScrollable();\r\n        if (scrollable) {\r\n            scrollable.update().done(() => {\r\n                deferred.resolveWith(this)\r\n            })\r\n        } else {\r\n            deferred.resolveWith(this)\r\n        }\r\n        return deferred.promise()\r\n    },\r\n    selectItem: function(itemElement) {\r\n        return this._updateItemSelection(true, itemElement)\r\n    },\r\n    unselectItem: function(itemElement) {\r\n        return this._updateItemSelection(false, itemElement)\r\n    },\r\n    expandItem: function(itemElement) {\r\n        return this._toggleExpandedState(itemElement, true)\r\n    },\r\n    collapseItem: function(itemElement) {\r\n        return this._toggleExpandedState(itemElement, false)\r\n    },\r\n    getNodes: function() {\r\n        return this._dataAdapter.getTreeNodes()\r\n    },\r\n    getSelectedNodes: function() {\r\n        return this.getSelectedNodeKeys().map(key => {\r\n            var node = this._dataAdapter.getNodeByKey(key);\r\n            return this._dataAdapter.getPublicNode(node)\r\n        })\r\n    },\r\n    getSelectedNodesKeys: function() {\r\n        errors.log(\"W0002\", \"dxTreeView\", \"getSelectedNodesKeys\", \"20.1\", \"Use the 'getSelectedNodeKeys' method instead\");\r\n        return this.getSelectedNodeKeys()\r\n    },\r\n    getSelectedNodeKeys: function() {\r\n        return this._dataAdapter.getSelectedNodesKeys()\r\n    },\r\n    selectAll: function() {\r\n        if (this._selectAllEnabled()) {\r\n            this._$selectAllItem.dxCheckBox(\"instance\").option(\"value\", true)\r\n        } else {\r\n            this._toggleSelectAll({\r\n                value: true\r\n            })\r\n        }\r\n    },\r\n    unselectAll: function() {\r\n        if (this._selectAllEnabled()) {\r\n            this._$selectAllItem.dxCheckBox(\"instance\").option(\"value\", false)\r\n        } else {\r\n            this._toggleSelectAll({\r\n                value: false\r\n            })\r\n        }\r\n    },\r\n    expandAll: function() {\r\n        var dataAdapter = this._dataAdapter;\r\n        each(dataAdapter.getData(), (_, node) => dataAdapter.toggleExpansion(node.internalFields.key, true));\r\n        this.repaint()\r\n    },\r\n    collapseAll: function() {\r\n        each(this._dataAdapter.getExpandedNodesKeys(), function(_, key) {\r\n            this._toggleExpandedState(key, false)\r\n        }.bind(this))\r\n    },\r\n    scrollToItem: function(keyOrItemOrElement) {\r\n        var node = this._getNode(keyOrItemOrElement);\r\n        if (!node) {\r\n            return (new Deferred).reject().promise()\r\n        }\r\n        var nodeKeysToExpand = [];\r\n        var parentNode = node.internalFields.publicNode.parent;\r\n        while (null != parentNode) {\r\n            if (!parentNode.expanded) {\r\n                nodeKeysToExpand.push(parentNode.key)\r\n            }\r\n            parentNode = parentNode.parent\r\n        }\r\n        var scrollCallback = new Deferred;\r\n        this._expandNodes(nodeKeysToExpand.reverse()).always(() => {\r\n            var $element = this._getNodeElement(node);\r\n            if ($element && $element.length) {\r\n                this.scrollToElementTopLeft($element.get(0));\r\n                scrollCallback.resolve()\r\n            } else {\r\n                scrollCallback.reject()\r\n            }\r\n        });\r\n        return scrollCallback.promise()\r\n    },\r\n    scrollToElementTopLeft: function(targetElement) {\r\n        var scrollable = this.getScrollable();\r\n        var {\r\n            scrollDirection: scrollDirection,\r\n            rtlEnabled: rtlEnabled\r\n        } = this.option();\r\n        var targetLocation = {\r\n            top: 0,\r\n            left: 0\r\n        };\r\n        var relativeOffset = getRelativeOffset(SCROLLABLE_CONTENT_CLASS, targetElement);\r\n        if (scrollDirection !== DIRECTION_VERTICAL) {\r\n            var containerElement = $(scrollable.container()).get(0);\r\n            targetLocation.left = rtlEnabled ? relativeOffset.left + targetElement.offsetWidth - containerElement.clientWidth : relativeOffset.left\r\n        }\r\n        if (scrollDirection !== DIRECTION_HORIZONTAL) {\r\n            targetLocation.top = relativeOffset.top\r\n        }\r\n        scrollable.scrollTo(targetLocation)\r\n    },\r\n    _expandNodes: function(keysToExpand) {\r\n        if (!keysToExpand || 0 === keysToExpand.length) {\r\n            return (new Deferred).resolve().promise()\r\n        }\r\n        var resultCallback = new Deferred;\r\n        var callbacksByNodes = keysToExpand.map(key => this.expandItem(key));\r\n        when.apply($, callbacksByNodes).done(() => resultCallback.resolve()).fail(() => resultCallback.reject());\r\n        return resultCallback.promise()\r\n    },\r\n    _dispose: function() {\r\n        this.callBase();\r\n        clearTimeout(this._setFocusedItemTimeout)\r\n    }\r\n});\r\nexport default TreeViewBase;\r\n"]},"metadata":{},"sourceType":"module"}