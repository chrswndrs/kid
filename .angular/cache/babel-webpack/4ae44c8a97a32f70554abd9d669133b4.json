{"ast":null,"code":"/**\r\n * DevExtreme (esm/exporter/image_creator.js)\r\n * Version: 21.2.4\r\n * Build date: Mon Dec 06 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../core/renderer\";\nimport Color from \"../color\";\nimport { isFunction, isPromise, isDefined } from \"../core/utils/type\";\nimport { getSvgElement, HIDDEN_FOR_EXPORT } from \"../core/utils/svg\";\nimport { each as _each, map as _map } from \"../core/utils/iterator\";\nimport { extend } from \"../core/utils/extend\";\nimport domAdapter from \"../core/dom_adapter\";\nimport { contains } from \"../core/utils/dom\";\nimport { getWindow } from \"../core/utils/window\";\nvar window = getWindow();\nimport { camelize } from \"../core/utils/inflector\";\nimport { Deferred, fromPromise } from \"../core/utils/deferred\";\nvar _math = Math;\nvar PI = _math.PI;\nvar _min = _math.min;\nvar _abs = _math.abs;\nvar _sqrt = _math.sqrt;\nvar _pow = _math.pow;\nvar _atan2 = _math.atan2;\nvar _cos = _math.cos;\nvar _sin = _math.sin;\nvar _number = Number;\nvar IMAGE_QUALITY = 1;\nvar TEXT_DECORATION_LINE_WIDTH_COEFF = .05;\nvar DEFAULT_FONT_SIZE = \"10px\";\nvar DEFAULT_FONT_FAMILY = \"sans-serif\";\nvar DEFAULT_TEXT_COLOR = \"#000\";\nvar parseAttributes;\n\nfunction getStringFromCanvas(canvas, mimeType) {\n  var dataURL = canvas.toDataURL(mimeType, IMAGE_QUALITY);\n  var imageData = window.atob(dataURL.substring((\"data:\" + mimeType + \";base64,\").length));\n  return imageData;\n}\n\nfunction arcTo(x1, y1, x2, y2, radius, largeArcFlag, clockwise, context) {\n  var cBx = (x1 + x2) / 2;\n  var cBy = (y1 + y2) / 2;\n\n  var aB = _atan2(y1 - y2, x1 - x2);\n\n  var k = largeArcFlag ? 1 : -1;\n  aB += PI / 180 * 90 * (clockwise ? 1 : -1);\n  var opSide = _sqrt(_pow(x2 - x1, 2) + _pow(y2 - y1, 2)) / 2;\n\n  var adjSide = _sqrt(_abs(_pow(radius, 2) - _pow(opSide, 2)));\n\n  var centerX = cBx + k * (adjSide * _cos(aB));\n\n  var centerY = cBy + k * (adjSide * _sin(aB));\n\n  var startAngle = _atan2(y1 - centerY, x1 - centerX);\n\n  var endAngle = _atan2(y2 - centerY, x2 - centerX);\n\n  context.arc(centerX, centerY, radius, startAngle, endAngle, !clockwise);\n}\n\nfunction getElementOptions(element, rootAppended) {\n  var attr = parseAttributes(element.attributes || {});\n  var options = extend({}, attr, {\n    text: element.textContent.replace(/\\s+/g, \" \"),\n    textAlign: \"middle\" === attr[\"text-anchor\"] ? \"center\" : attr[\"text-anchor\"]\n  });\n  var transform = attr.transform;\n  var coords;\n\n  if (transform) {\n    coords = transform.match(/translate\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*)*/);\n\n    if (coords) {\n      coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\n      options.translateX = _number(coords[0]);\n      options.translateY = coords[1] ? _number(coords[1]) : 0;\n    }\n\n    coords = transform.match(/rotate\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*,*\\s*-*\\d+([.]\\d+)*)*/);\n\n    if (coords) {\n      coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\n      options.rotationAngle = _number(coords[0]);\n      options.rotationX = coords[1] && _number(coords[1]);\n      options.rotationY = coords[2] && _number(coords[2]);\n    }\n\n    coords = transform.match(/scale\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*)*/);\n\n    if (coords) {\n      coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\n      options.scaleX = _number(coords[0]);\n\n      if (coords.length > 1) {\n        options.scaleY = _number(coords[1]);\n      } else {\n        options.scaleY = options.scaleX;\n      }\n    }\n  }\n\n  parseStyles(element, options, rootAppended);\n  return options;\n}\n\nfunction drawRect(context, options) {\n  var x = options.x;\n  var y = options.y;\n  var width = options.width;\n  var height = options.height;\n  var cornerRadius = options.rx;\n\n  if (!cornerRadius) {\n    context.rect(x, y, width, height);\n  } else {\n    cornerRadius = _min(cornerRadius, width / 2, height / 2);\n    context.save();\n    context.translate(x, y);\n    context.moveTo(width / 2, 0);\n    context.arcTo(width, 0, width, height, cornerRadius);\n    context.arcTo(width, height, 0, height, cornerRadius);\n    context.arcTo(0, height, 0, 0, cornerRadius);\n    context.arcTo(0, 0, cornerRadius, 0, cornerRadius);\n    context.lineTo(width / 2, 0);\n    context.restore();\n  }\n}\n\nfunction drawImage(context, options, shared) {\n  var d = new Deferred();\n  var image = new window.Image();\n\n  image.onload = function () {\n    context.save();\n    context.globalAlpha = options.globalAlpha;\n    transformElement(context, options);\n    clipElement(context, options, shared);\n    context.drawImage(image, options.x, options.y, options.width, options.height);\n    context.restore();\n    d.resolve();\n  };\n\n  image.onerror = function () {\n    d.resolve();\n  };\n\n  image.setAttribute(\"crossOrigin\", \"anonymous\");\n  image.src = options.href || options[\"xlink:href\"];\n  return d;\n}\n\nfunction drawPath(context, dAttr) {\n  var dArray = dAttr.replace(/,/g, \" \").split(/([A-Z])/i).filter(item => \"\" !== item.trim());\n  var i = 0;\n  var params;\n  var prevParams;\n  var prevParamsLen;\n\n  do {\n    params = (dArray[i + 1] || \"\").trim().split(\" \");\n\n    switch (dArray[i]) {\n      case \"M\":\n        context.moveTo(_number(params[0]), _number(params[1]));\n        i += 2;\n        break;\n\n      case \"L\":\n        for (var j = 0; j < params.length / 2; j++) {\n          context.lineTo(_number(params[2 * j]), _number(params[2 * j + 1]));\n        }\n\n        i += 2;\n        break;\n\n      case \"C\":\n        context.bezierCurveTo(_number(params[0]), _number(params[1]), _number(params[2]), _number(params[3]), _number(params[4]), _number(params[5]));\n        i += 2;\n        break;\n\n      case \"a\":\n        prevParams = dArray[i - 1].trim().split(\" \");\n        prevParamsLen = prevParams.length - 1;\n        arcTo(_number(prevParams[prevParamsLen - 1]), _number(prevParams[prevParamsLen]), _number(prevParams[prevParamsLen - 1]) + _number(params[5]), _number(prevParams[prevParamsLen]) + _number(params[6]), _number(params[0]), _number(params[3]), _number(params[4]), context);\n        i += 2;\n        break;\n\n      case \"A\":\n        prevParams = dArray[i - 1].trim().split(\" \");\n        prevParamsLen = prevParams.length - 1;\n        arcTo(_number(prevParams[prevParamsLen - 1]), _number(prevParams[prevParamsLen]), _number(params[5]), _number(params[6]), _number(params[0]), _number(params[3]), _number(params[4]), context);\n        i += 2;\n        break;\n\n      case \"Z\":\n        context.closePath();\n        i += 1;\n        break;\n\n      default:\n        i++;\n    }\n  } while (i < dArray.length);\n}\n\nfunction parseStyles(element, options, rootAppended) {\n  var style = element.style || {};\n  var field;\n\n  for (field in style) {\n    if (\"\" !== style[field]) {\n      options[camelize(field)] = style[field];\n    }\n  }\n\n  if (rootAppended && domAdapter.isElementNode(element)) {\n    style = window.getComputedStyle(element);\n    [\"fill\", \"stroke\", \"stroke-width\", \"font-family\", \"font-size\", \"font-style\", \"font-weight\"].forEach(function (prop) {\n      if (prop in style && \"\" !== style[prop]) {\n        options[camelize(prop)] = style[prop];\n      }\n    });\n    [\"opacity\", \"fill-opacity\", \"stroke-opacity\"].forEach(function (prop) {\n      if (prop in style && \"\" !== style[prop] && \"1\" !== style[prop]) {\n        options[prop] = _number(style[prop]);\n      }\n    });\n  }\n\n  options.textDecoration = options.textDecoration || options.textDecorationLine;\n  options.globalAlpha = isDefined(options.opacity) ? options.opacity : options.globalAlpha;\n}\n\nfunction parseUrl(urlString) {\n  var matches = urlString && urlString.match(/url\\(.*#(.*?)[\"']?\\)/i);\n  return matches && matches[1];\n}\n\nfunction setFontStyle(context, options) {\n  var fontParams = [];\n  options.fontSize = options.fontSize || DEFAULT_FONT_SIZE;\n  options.fontFamily = options.fontFamily || DEFAULT_FONT_FAMILY;\n  options.fill = options.fill || DEFAULT_TEXT_COLOR;\n  options.fontStyle && fontParams.push(options.fontStyle);\n  options.fontWeight && fontParams.push(options.fontWeight);\n  fontParams.push(options.fontSize);\n  fontParams.push(options.fontFamily);\n  context.font = fontParams.join(\" \");\n  context.textAlign = options.textAlign;\n  context.fillStyle = options.fill;\n  context.globalAlpha = options.globalAlpha;\n}\n\nfunction drawText(context, options, shared) {\n  setFontStyle(context, options);\n  applyFilter(context, options, shared);\n  options.text && context.fillText(options.text, options.x || 0, options.y || 0);\n  strokeElement(context, options, true);\n  drawTextDecoration(context, options, shared);\n}\n\nfunction drawTextDecoration(context, options, shared) {\n  if (!options.textDecoration || \"none\" === options.textDecoration) {\n    return;\n  }\n\n  var x = options.x;\n  var textWidth = context.measureText(options.text).width;\n  var textHeight = parseInt(options.fontSize, 10);\n  var lineHeight = textHeight * TEXT_DECORATION_LINE_WIDTH_COEFF < 1 ? 1 : textHeight * TEXT_DECORATION_LINE_WIDTH_COEFF;\n  var y = options.y;\n\n  switch (options.textDecoration) {\n    case \"line-through\":\n      y -= textHeight / 3 + lineHeight / 2;\n      break;\n\n    case \"overline\":\n      y -= textHeight - lineHeight;\n      break;\n\n    case \"underline\":\n      y += lineHeight;\n  }\n\n  context.rect(x, y, textWidth, lineHeight);\n  fillElement(context, options, shared);\n  strokeElement(context, options);\n}\n\nfunction aggregateOpacity(options) {\n  options.strokeOpacity = void 0 !== options[\"stroke-opacity\"] ? options[\"stroke-opacity\"] : 1;\n  options.fillOpacity = void 0 !== options[\"fill-opacity\"] ? options[\"fill-opacity\"] : 1;\n\n  if (void 0 !== options.opacity) {\n    options.strokeOpacity *= options.opacity;\n    options.fillOpacity *= options.opacity;\n  }\n}\n\nfunction hasTspan(element) {\n  var nodes = element.childNodes;\n\n  for (var i = 0; i < nodes.length; i++) {\n    if (\"tspan\" === nodes[i].tagName) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction drawTextElement(childNodes, context, options, shared) {\n  var lines = [];\n  var line;\n  var offset = 0;\n\n  for (var i = 0; i < childNodes.length; i++) {\n    var element = childNodes[i];\n\n    if (void 0 === element.tagName) {\n      drawElement(element, context, options, shared);\n    } else if (\"tspan\" === element.tagName || \"text\" === element.tagName) {\n      var elementOptions = getElementOptions(element, shared.rootAppended);\n      var mergedOptions = extend({}, options, elementOptions);\n\n      if (\"tspan\" === element.tagName && hasTspan(element)) {\n        drawTextElement(element.childNodes, context, mergedOptions, shared);\n        continue;\n      }\n\n      mergedOptions.textAlign = \"start\";\n\n      if (!line || void 0 !== elementOptions.x) {\n        line = {\n          elements: [],\n          options: [],\n          widths: [],\n          offsets: []\n        };\n        lines.push(line);\n      }\n\n      if (void 0 !== elementOptions.y) {\n        offset = 0;\n      }\n\n      if (void 0 !== elementOptions.dy) {\n        offset += parseFloat(elementOptions.dy);\n      }\n\n      line.elements.push(element);\n      line.options.push(mergedOptions);\n      line.offsets.push(offset);\n      setFontStyle(context, mergedOptions);\n      line.widths.push(context.measureText(mergedOptions.text).width);\n    }\n  }\n\n  lines.forEach(function (line) {\n    var commonWidth = line.widths.reduce(function (commonWidth, width) {\n      return commonWidth + width;\n    }, 0);\n    var xDiff = 0;\n    var currentOffset = 0;\n\n    if (\"center\" === options.textAlign) {\n      xDiff = commonWidth / 2;\n    }\n\n    if (\"end\" === options.textAlign) {\n      xDiff = commonWidth;\n    }\n\n    line.options.forEach(function (o, index) {\n      var width = line.widths[index];\n      o.x = o.x - xDiff + currentOffset;\n      o.y += line.offsets[index];\n      currentOffset += width;\n    });\n    line.elements.forEach(function (element, index) {\n      drawTextElement(element.childNodes, context, line.options[index], shared);\n    });\n  });\n}\n\nfunction drawElement(element, context, parentOptions, shared) {\n  var tagName = element.tagName;\n  var isText = \"text\" === tagName || \"tspan\" === tagName || void 0 === tagName;\n  var isImage = \"image\" === tagName;\n  var options = extend({}, parentOptions, getElementOptions(element, shared.rootAppended));\n\n  if (\"hidden\" === options.visibility || options[HIDDEN_FOR_EXPORT]) {\n    return;\n  }\n\n  context.save();\n  !isImage && transformElement(context, options);\n  clipElement(context, options, shared);\n  aggregateOpacity(options);\n  var promise;\n  context.beginPath();\n\n  switch (element.tagName) {\n    case void 0:\n      drawText(context, options, shared);\n      break;\n\n    case \"text\":\n    case \"tspan\":\n      drawTextElement(element.childNodes, context, options, shared);\n      break;\n\n    case \"image\":\n      promise = drawImage(context, options, shared);\n      break;\n\n    case \"path\":\n      drawPath(context, options.d);\n      break;\n\n    case \"rect\":\n      drawRect(context, options);\n      context.closePath();\n      break;\n\n    case \"circle\":\n      context.arc(options.cx, options.cy, options.r, 0, 2 * PI, 1);\n  }\n\n  if (!isText) {\n    applyFilter(context, options, shared);\n    fillElement(context, options, shared);\n    strokeElement(context, options);\n  }\n\n  applyGradient(context, options, shared, element);\n  context.restore();\n  return promise;\n}\n\nfunction applyGradient(context, options, _ref, element) {\n  var {\n    gradients: gradients\n  } = _ref;\n\n  if (0 === gradients.length) {\n    return;\n  }\n\n  var id = parseUrl(options.fill);\n\n  if (id && gradients[id]) {\n    var box = element.getBBox();\n    var gradient = context.createLinearGradient(box.x, 0, box.x + box.width, 0);\n    gradients[id].forEach(opt => {\n      var offset = parseInt(opt.offset.replace(/%/, \"\"));\n      gradient.addColorStop(offset / 100, opt.stopColor);\n    });\n    context.globalAlpha = options.opacity;\n    context.fillStyle = gradient;\n    context.fill();\n  }\n}\n\nfunction applyFilter(context, options, shared) {\n  var filterOptions;\n  var id = parseUrl(options.filter);\n\n  if (id) {\n    filterOptions = shared.filters[id];\n\n    if (!filterOptions) {\n      filterOptions = {\n        offsetX: 0,\n        offsetY: 0,\n        blur: 0,\n        color: \"#000\"\n      };\n    }\n\n    context.shadowOffsetX = filterOptions.offsetX;\n    context.shadowOffsetY = filterOptions.offsetY;\n    context.shadowColor = filterOptions.color;\n    context.shadowBlur = filterOptions.blur;\n  }\n}\n\nfunction transformElement(context, options) {\n  context.translate(options.translateX || 0, options.translateY || 0);\n  options.translateX = void 0;\n  options.translateY = void 0;\n\n  if (options.rotationAngle) {\n    context.translate(options.rotationX || 0, options.rotationY || 0);\n    context.rotate(options.rotationAngle * PI / 180);\n    context.translate(-(options.rotationX || 0), -(options.rotationY || 0));\n    options.rotationAngle = void 0;\n    options.rotationX = void 0;\n    options.rotationY = void 0;\n  }\n\n  if (isFinite(options.scaleX)) {\n    context.scale(options.scaleX, options.scaleY);\n    options.scaleX = void 0;\n    options.scaleY = void 0;\n  }\n}\n\nfunction clipElement(context, options, shared) {\n  if (options[\"clip-path\"]) {\n    drawElement(shared.clipPaths[parseUrl(options[\"clip-path\"])], context, {}, shared);\n    context.clip();\n    options[\"clip-path\"] = void 0;\n  }\n}\n\nfunction hex2rgba(hexColor, alpha) {\n  var color = new Color(hexColor);\n  return \"rgba(\" + color.r + \",\" + color.g + \",\" + color.b + \",\" + alpha + \")\";\n}\n\nfunction createGradient(element) {\n  var options = [];\n\n  _each(element.childNodes, (_, _ref2) => {\n    var {\n      attributes: attributes\n    } = _ref2;\n    options.push({\n      offset: attributes.offset.value,\n      stopColor: attributes[\"stop-color\"].value\n    });\n  });\n\n  return options;\n}\n\nfunction createFilter(element) {\n  var color;\n  var opacity;\n  var filterOptions = {};\n\n  _each(element.childNodes, function (_, node) {\n    var attr = node.attributes;\n\n    if (!attr.result) {\n      return;\n    }\n\n    switch (attr.result.value) {\n      case \"gaussianBlurResult\":\n        filterOptions.blur = _number(attr.stdDeviation.value);\n        break;\n\n      case \"offsetResult\":\n        filterOptions.offsetX = _number(attr.dx.value);\n        filterOptions.offsetY = _number(attr.dy.value);\n        break;\n\n      case \"floodResult\":\n        color = attr[\"flood-color\"] ? attr[\"flood-color\"].value : \"#000\";\n        opacity = attr[\"flood-opacity\"] ? attr[\"flood-opacity\"].value : 1;\n        filterOptions.color = hex2rgba(color, opacity);\n    }\n  });\n\n  return filterOptions;\n}\n\nfunction asyncEach(array, callback) {\n  var d = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : new Deferred();\n  var i = 0;\n\n  for (; i < array.length; i++) {\n    var result = callback(array[i]);\n\n    if (isPromise(result)) {\n      result.then(() => {\n        asyncEach(Array.prototype.slice.call(array, i + 1), callback, d);\n      });\n      break;\n    }\n  }\n\n  if (i === array.length) {\n    d.resolve();\n  }\n\n  return d;\n}\n\nfunction drawCanvasElements(elements, context, parentOptions, shared) {\n  return asyncEach(elements, function (element) {\n    switch (element.tagName && element.tagName.toLowerCase()) {\n      case \"g\":\n      case \"svg\":\n        var options = extend({}, parentOptions, getElementOptions(element, shared.rootAppended));\n        context.save();\n        transformElement(context, options);\n        clipElement(context, options, shared);\n\n        var onDone = () => {\n          context.restore();\n        };\n\n        var d = drawCanvasElements(element.childNodes, context, options, shared);\n\n        if (isPromise(d)) {\n          d.then(onDone);\n        } else {\n          onDone();\n        }\n\n        return d;\n\n      case \"defs\":\n        return drawCanvasElements(element.childNodes, context, {}, shared);\n\n      case \"clippath\":\n        shared.clipPaths[element.attributes.id.textContent] = element.childNodes[0];\n        break;\n\n      case \"pattern\":\n        shared.patterns[element.attributes.id.textContent] = element;\n        break;\n\n      case \"filter\":\n        shared.filters[element.id] = createFilter(element);\n        break;\n\n      case \"lineargradient\":\n        shared.gradients[element.attributes.id.textContent] = createGradient(element);\n        break;\n\n      default:\n        return drawElement(element, context, parentOptions, shared);\n    }\n  });\n}\n\nfunction setLineDash(context, options) {\n  var matches = options[\"stroke-dasharray\"] && options[\"stroke-dasharray\"].match(/(\\d+)/g);\n\n  if (matches && matches.length) {\n    matches = _map(matches, function (item) {\n      return _number(item);\n    });\n    context.setLineDash(matches);\n  }\n}\n\nfunction strokeElement(context, options, isText) {\n  var stroke = options.stroke;\n\n  if (stroke && \"none\" !== stroke && 0 !== options[\"stroke-width\"]) {\n    setLineDash(context, options);\n    context.lineJoin = options[\"stroke-linejoin\"];\n    context.lineWidth = options[\"stroke-width\"];\n    context.globalAlpha = options.strokeOpacity;\n    context.strokeStyle = stroke;\n    isText ? context.strokeText(options.text, options.x, options.y) : context.stroke();\n    context.globalAlpha = 1;\n  }\n}\n\nfunction getPattern(context, pattern, shared) {\n  var options = getElementOptions(pattern, shared.rootAppended);\n\n  var patternCanvas = imageCreator._createCanvas(options.width, options.height, 0);\n\n  var patternContext = patternCanvas.getContext(\"2d\");\n  drawCanvasElements(pattern.childNodes, patternContext, options, shared);\n  return context.createPattern(patternCanvas, \"repeat\");\n}\n\nfunction fillElement(context, options, shared) {\n  var fill = options.fill;\n\n  if (fill && \"none\" !== fill) {\n    if (-1 === fill.search(/url/)) {\n      context.fillStyle = fill;\n    } else {\n      var pattern = shared.patterns[parseUrl(fill)];\n\n      if (!pattern) {\n        return;\n      }\n\n      context.fillStyle = getPattern(context, pattern, shared);\n    }\n\n    context.globalAlpha = options.fillOpacity;\n    context.fill();\n    context.globalAlpha = 1;\n  }\n}\n\nparseAttributes = function (attributes) {\n  var newAttributes = {};\n  var attr;\n\n  _each(attributes, function (index, item) {\n    attr = item.textContent;\n\n    if (isFinite(attr)) {\n      attr = _number(attr);\n    }\n\n    newAttributes[item.name.toLowerCase()] = attr;\n  });\n\n  return newAttributes;\n};\n\nfunction drawBackground(context, width, height, backgroundColor, margin) {\n  context.fillStyle = backgroundColor || \"#ffffff\";\n  context.fillRect(-margin, -margin, width + 2 * margin, height + 2 * margin);\n}\n\nfunction createInvisibleDiv() {\n  var invisibleDiv = domAdapter.createElement(\"div\");\n  invisibleDiv.style.left = \"-9999px\";\n  invisibleDiv.style.position = \"absolute\";\n  return invisibleDiv;\n}\n\nfunction convertSvgToCanvas(svg, canvas, rootAppended) {\n  return drawCanvasElements(svg.childNodes, canvas.getContext(\"2d\"), {}, {\n    clipPaths: {},\n    patterns: {},\n    filters: {},\n    gradients: {},\n    rootAppended: rootAppended\n  });\n}\n\nfunction getCanvasFromSvg(markup, _ref3) {\n  var {\n    width: width,\n    height: height,\n    backgroundColor: backgroundColor,\n    margin: margin,\n    svgToCanvas = convertSvgToCanvas\n  } = _ref3;\n  var scaledScreenInfo = calcScaledInfo(width, height);\n\n  var canvas = imageCreator._createCanvas(scaledScreenInfo.width, scaledScreenInfo.height, margin);\n\n  var context = canvas.getContext(\"2d\");\n  context.setTransform(scaledScreenInfo.pixelRatio, 0, 0, scaledScreenInfo.pixelRatio, 0, 0);\n  var svgElem = getSvgElement(markup);\n  var invisibleDiv;\n  var markupIsDomElement = domAdapter.isElementNode(markup);\n  context.translate(margin, margin);\n  domAdapter.getBody().appendChild(canvas);\n\n  if (!markupIsDomElement) {\n    invisibleDiv = createInvisibleDiv();\n    invisibleDiv.appendChild(svgElem);\n    domAdapter.getBody().appendChild(invisibleDiv);\n  }\n\n  if (svgElem.attributes.direction) {\n    canvas.dir = svgElem.attributes.direction.textContent;\n  }\n\n  drawBackground(context, width, height, backgroundColor, margin);\n  return fromPromise(svgToCanvas(svgElem, canvas, markupIsDomElement && contains(domAdapter.getBody(), markup))).then(() => canvas).always(() => {\n    invisibleDiv && domAdapter.getBody().removeChild(invisibleDiv);\n    domAdapter.getBody().removeChild(canvas);\n  });\n}\n\nexport var imageCreator = {\n  getImageData: function (markup, options) {\n    var mimeType = \"image/\" + options.format;\n\n    if (isFunction(options.__parseAttributesFn)) {\n      parseAttributes = options.__parseAttributesFn;\n    }\n\n    return getCanvasFromSvg(markup, options).then(canvas => getStringFromCanvas(canvas, mimeType));\n  },\n  getData: function (markup, options) {\n    var that = this;\n    return imageCreator.getImageData(markup, options).then(binaryData => {\n      var mimeType = \"image/\" + options.format;\n      var data = isFunction(window.Blob) && !options.forceProxy ? that._getBlob(binaryData, mimeType) : that._getBase64(binaryData);\n      return data;\n    });\n  },\n  _getBlob: function (binaryData, mimeType) {\n    var i;\n    var dataArray = new Uint8Array(binaryData.length);\n\n    for (i = 0; i < binaryData.length; i++) {\n      dataArray[i] = binaryData.charCodeAt(i);\n    }\n\n    return new window.Blob([dataArray.buffer], {\n      type: mimeType\n    });\n  },\n  _getBase64: function (binaryData) {\n    return window.btoa(binaryData);\n  },\n\n  _createCanvas(width, height, margin) {\n    var canvas = $(\"<canvas>\")[0];\n    canvas.width = width + 2 * margin;\n    canvas.height = height + 2 * margin;\n    canvas.hidden = true;\n    return canvas;\n  }\n\n};\nexport function getData(data, options) {\n  return imageCreator.getData(data, options);\n}\nexport function testFormats(formats) {\n  var canvas = imageCreator._createCanvas(100, 100, 0);\n\n  return formats.reduce(function (r, f) {\n    var mimeType = (\"image/\" + f).toLowerCase();\n\n    if (-1 !== canvas.toDataURL(mimeType).indexOf(mimeType)) {\n      r.supported.push(f);\n    } else {\n      r.unsupported.push(f);\n    }\n\n    return r;\n  }, {\n    supported: [],\n    unsupported: []\n  });\n}\nexport function calcScaledInfo(width, height) {\n  var pixelRatio = window.devicePixelRatio || 1;\n  return {\n    pixelRatio: pixelRatio,\n    width: width * pixelRatio,\n    height: height * pixelRatio\n  };\n}","map":{"version":3,"sources":["/home/chrswndrs/Documents/poc/typescript/angular/kid/node_modules/devextreme/esm/exporter/image_creator.js"],"names":["$","Color","isFunction","isPromise","isDefined","getSvgElement","HIDDEN_FOR_EXPORT","each","_each","map","_map","extend","domAdapter","contains","getWindow","window","camelize","Deferred","fromPromise","_math","Math","PI","_min","min","_abs","abs","_sqrt","sqrt","_pow","pow","_atan2","atan2","_cos","cos","_sin","sin","_number","Number","IMAGE_QUALITY","TEXT_DECORATION_LINE_WIDTH_COEFF","DEFAULT_FONT_SIZE","DEFAULT_FONT_FAMILY","DEFAULT_TEXT_COLOR","parseAttributes","getStringFromCanvas","canvas","mimeType","dataURL","toDataURL","imageData","atob","substring","length","arcTo","x1","y1","x2","y2","radius","largeArcFlag","clockwise","context","cBx","cBy","aB","k","opSide","adjSide","centerX","centerY","startAngle","endAngle","arc","getElementOptions","element","rootAppended","attr","attributes","options","text","textContent","replace","textAlign","transform","coords","match","translateX","translateY","rotationAngle","rotationX","rotationY","scaleX","scaleY","parseStyles","drawRect","x","y","width","height","cornerRadius","rx","rect","save","translate","moveTo","lineTo","restore","drawImage","shared","d","image","Image","onload","globalAlpha","transformElement","clipElement","resolve","onerror","setAttribute","src","href","drawPath","dAttr","dArray","split","filter","item","trim","i","params","prevParams","prevParamsLen","j","bezierCurveTo","closePath","style","field","isElementNode","getComputedStyle","forEach","prop","textDecoration","textDecorationLine","opacity","parseUrl","urlString","matches","setFontStyle","fontParams","fontSize","fontFamily","fill","fontStyle","push","fontWeight","font","join","fillStyle","drawText","applyFilter","fillText","strokeElement","drawTextDecoration","textWidth","measureText","textHeight","parseInt","lineHeight","fillElement","aggregateOpacity","strokeOpacity","fillOpacity","hasTspan","nodes","childNodes","tagName","drawTextElement","lines","line","offset","drawElement","elementOptions","mergedOptions","elements","widths","offsets","dy","parseFloat","commonWidth","reduce","xDiff","currentOffset","o","index","parentOptions","isText","isImage","visibility","promise","beginPath","cx","cy","r","applyGradient","_ref","gradients","id","box","getBBox","gradient","createLinearGradient","opt","addColorStop","stopColor","filterOptions","filters","offsetX","offsetY","blur","color","shadowOffsetX","shadowOffsetY","shadowColor","shadowBlur","rotate","isFinite","scale","clipPaths","clip","hex2rgba","hexColor","alpha","g","b","createGradient","_","_ref2","value","createFilter","node","result","stdDeviation","dx","asyncEach","array","callback","arguments","then","Array","prototype","slice","call","drawCanvasElements","toLowerCase","onDone","patterns","setLineDash","stroke","lineJoin","lineWidth","strokeStyle","strokeText","getPattern","pattern","patternCanvas","imageCreator","_createCanvas","patternContext","getContext","createPattern","search","newAttributes","name","drawBackground","backgroundColor","margin","fillRect","createInvisibleDiv","invisibleDiv","createElement","left","position","convertSvgToCanvas","svg","getCanvasFromSvg","markup","_ref3","svgToCanvas","scaledScreenInfo","calcScaledInfo","setTransform","pixelRatio","svgElem","markupIsDomElement","getBody","appendChild","direction","dir","always","removeChild","getImageData","format","__parseAttributesFn","getData","that","binaryData","data","Blob","forceProxy","_getBlob","_getBase64","dataArray","Uint8Array","charCodeAt","buffer","type","btoa","hidden","testFormats","formats","f","indexOf","supported","unsupported","devicePixelRatio"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/exporter/image_creator.js)\r\n * Version: 21.2.4\r\n * Build date: Mon Dec 06 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../core/renderer\";\r\nimport Color from \"../color\";\r\nimport {\r\n    isFunction,\r\n    isPromise,\r\n    isDefined\r\n} from \"../core/utils/type\";\r\nimport {\r\n    getSvgElement,\r\n    HIDDEN_FOR_EXPORT\r\n} from \"../core/utils/svg\";\r\nimport {\r\n    each as _each,\r\n    map as _map\r\n} from \"../core/utils/iterator\";\r\nimport {\r\n    extend\r\n} from \"../core/utils/extend\";\r\nimport domAdapter from \"../core/dom_adapter\";\r\nimport {\r\n    contains\r\n} from \"../core/utils/dom\";\r\nimport {\r\n    getWindow\r\n} from \"../core/utils/window\";\r\nvar window = getWindow();\r\nimport {\r\n    camelize\r\n} from \"../core/utils/inflector\";\r\nimport {\r\n    Deferred,\r\n    fromPromise\r\n} from \"../core/utils/deferred\";\r\nvar _math = Math;\r\nvar PI = _math.PI;\r\nvar _min = _math.min;\r\nvar _abs = _math.abs;\r\nvar _sqrt = _math.sqrt;\r\nvar _pow = _math.pow;\r\nvar _atan2 = _math.atan2;\r\nvar _cos = _math.cos;\r\nvar _sin = _math.sin;\r\nvar _number = Number;\r\nvar IMAGE_QUALITY = 1;\r\nvar TEXT_DECORATION_LINE_WIDTH_COEFF = .05;\r\nvar DEFAULT_FONT_SIZE = \"10px\";\r\nvar DEFAULT_FONT_FAMILY = \"sans-serif\";\r\nvar DEFAULT_TEXT_COLOR = \"#000\";\r\nvar parseAttributes;\r\n\r\nfunction getStringFromCanvas(canvas, mimeType) {\r\n    var dataURL = canvas.toDataURL(mimeType, IMAGE_QUALITY);\r\n    var imageData = window.atob(dataURL.substring((\"data:\" + mimeType + \";base64,\").length));\r\n    return imageData\r\n}\r\n\r\nfunction arcTo(x1, y1, x2, y2, radius, largeArcFlag, clockwise, context) {\r\n    var cBx = (x1 + x2) / 2;\r\n    var cBy = (y1 + y2) / 2;\r\n    var aB = _atan2(y1 - y2, x1 - x2);\r\n    var k = largeArcFlag ? 1 : -1;\r\n    aB += PI / 180 * 90 * (clockwise ? 1 : -1);\r\n    var opSide = _sqrt(_pow(x2 - x1, 2) + _pow(y2 - y1, 2)) / 2;\r\n    var adjSide = _sqrt(_abs(_pow(radius, 2) - _pow(opSide, 2)));\r\n    var centerX = cBx + k * (adjSide * _cos(aB));\r\n    var centerY = cBy + k * (adjSide * _sin(aB));\r\n    var startAngle = _atan2(y1 - centerY, x1 - centerX);\r\n    var endAngle = _atan2(y2 - centerY, x2 - centerX);\r\n    context.arc(centerX, centerY, radius, startAngle, endAngle, !clockwise)\r\n}\r\n\r\nfunction getElementOptions(element, rootAppended) {\r\n    var attr = parseAttributes(element.attributes || {});\r\n    var options = extend({}, attr, {\r\n        text: element.textContent.replace(/\\s+/g, \" \"),\r\n        textAlign: \"middle\" === attr[\"text-anchor\"] ? \"center\" : attr[\"text-anchor\"]\r\n    });\r\n    var transform = attr.transform;\r\n    var coords;\r\n    if (transform) {\r\n        coords = transform.match(/translate\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*)*/);\r\n        if (coords) {\r\n            coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\r\n            options.translateX = _number(coords[0]);\r\n            options.translateY = coords[1] ? _number(coords[1]) : 0\r\n        }\r\n        coords = transform.match(/rotate\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*,*\\s*-*\\d+([.]\\d+)*)*/);\r\n        if (coords) {\r\n            coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\r\n            options.rotationAngle = _number(coords[0]);\r\n            options.rotationX = coords[1] && _number(coords[1]);\r\n            options.rotationY = coords[2] && _number(coords[2])\r\n        }\r\n        coords = transform.match(/scale\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*)*/);\r\n        if (coords) {\r\n            coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\r\n            options.scaleX = _number(coords[0]);\r\n            if (coords.length > 1) {\r\n                options.scaleY = _number(coords[1])\r\n            } else {\r\n                options.scaleY = options.scaleX\r\n            }\r\n        }\r\n    }\r\n    parseStyles(element, options, rootAppended);\r\n    return options\r\n}\r\n\r\nfunction drawRect(context, options) {\r\n    var x = options.x;\r\n    var y = options.y;\r\n    var width = options.width;\r\n    var height = options.height;\r\n    var cornerRadius = options.rx;\r\n    if (!cornerRadius) {\r\n        context.rect(x, y, width, height)\r\n    } else {\r\n        cornerRadius = _min(cornerRadius, width / 2, height / 2);\r\n        context.save();\r\n        context.translate(x, y);\r\n        context.moveTo(width / 2, 0);\r\n        context.arcTo(width, 0, width, height, cornerRadius);\r\n        context.arcTo(width, height, 0, height, cornerRadius);\r\n        context.arcTo(0, height, 0, 0, cornerRadius);\r\n        context.arcTo(0, 0, cornerRadius, 0, cornerRadius);\r\n        context.lineTo(width / 2, 0);\r\n        context.restore()\r\n    }\r\n}\r\n\r\nfunction drawImage(context, options, shared) {\r\n    var d = new Deferred;\r\n    var image = new window.Image;\r\n    image.onload = function() {\r\n        context.save();\r\n        context.globalAlpha = options.globalAlpha;\r\n        transformElement(context, options);\r\n        clipElement(context, options, shared);\r\n        context.drawImage(image, options.x, options.y, options.width, options.height);\r\n        context.restore();\r\n        d.resolve()\r\n    };\r\n    image.onerror = function() {\r\n        d.resolve()\r\n    };\r\n    image.setAttribute(\"crossOrigin\", \"anonymous\");\r\n    image.src = options.href || options[\"xlink:href\"];\r\n    return d\r\n}\r\n\r\nfunction drawPath(context, dAttr) {\r\n    var dArray = dAttr.replace(/,/g, \" \").split(/([A-Z])/i).filter(item => \"\" !== item.trim());\r\n    var i = 0;\r\n    var params;\r\n    var prevParams;\r\n    var prevParamsLen;\r\n    do {\r\n        params = (dArray[i + 1] || \"\").trim().split(\" \");\r\n        switch (dArray[i]) {\r\n            case \"M\":\r\n                context.moveTo(_number(params[0]), _number(params[1]));\r\n                i += 2;\r\n                break;\r\n            case \"L\":\r\n                for (var j = 0; j < params.length / 2; j++) {\r\n                    context.lineTo(_number(params[2 * j]), _number(params[2 * j + 1]))\r\n                }\r\n                i += 2;\r\n                break;\r\n            case \"C\":\r\n                context.bezierCurveTo(_number(params[0]), _number(params[1]), _number(params[2]), _number(params[3]), _number(params[4]), _number(params[5]));\r\n                i += 2;\r\n                break;\r\n            case \"a\":\r\n                prevParams = dArray[i - 1].trim().split(\" \");\r\n                prevParamsLen = prevParams.length - 1;\r\n                arcTo(_number(prevParams[prevParamsLen - 1]), _number(prevParams[prevParamsLen]), _number(prevParams[prevParamsLen - 1]) + _number(params[5]), _number(prevParams[prevParamsLen]) + _number(params[6]), _number(params[0]), _number(params[3]), _number(params[4]), context);\r\n                i += 2;\r\n                break;\r\n            case \"A\":\r\n                prevParams = dArray[i - 1].trim().split(\" \");\r\n                prevParamsLen = prevParams.length - 1;\r\n                arcTo(_number(prevParams[prevParamsLen - 1]), _number(prevParams[prevParamsLen]), _number(params[5]), _number(params[6]), _number(params[0]), _number(params[3]), _number(params[4]), context);\r\n                i += 2;\r\n                break;\r\n            case \"Z\":\r\n                context.closePath();\r\n                i += 1;\r\n                break;\r\n            default:\r\n                i++\r\n        }\r\n    } while (i < dArray.length)\r\n}\r\n\r\nfunction parseStyles(element, options, rootAppended) {\r\n    var style = element.style || {};\r\n    var field;\r\n    for (field in style) {\r\n        if (\"\" !== style[field]) {\r\n            options[camelize(field)] = style[field]\r\n        }\r\n    }\r\n    if (rootAppended && domAdapter.isElementNode(element)) {\r\n        style = window.getComputedStyle(element);\r\n        [\"fill\", \"stroke\", \"stroke-width\", \"font-family\", \"font-size\", \"font-style\", \"font-weight\"].forEach((function(prop) {\r\n            if (prop in style && \"\" !== style[prop]) {\r\n                options[camelize(prop)] = style[prop]\r\n            }\r\n        }));\r\n        [\"opacity\", \"fill-opacity\", \"stroke-opacity\"].forEach((function(prop) {\r\n            if (prop in style && \"\" !== style[prop] && \"1\" !== style[prop]) {\r\n                options[prop] = _number(style[prop])\r\n            }\r\n        }))\r\n    }\r\n    options.textDecoration = options.textDecoration || options.textDecorationLine;\r\n    options.globalAlpha = isDefined(options.opacity) ? options.opacity : options.globalAlpha\r\n}\r\n\r\nfunction parseUrl(urlString) {\r\n    var matches = urlString && urlString.match(/url\\(.*#(.*?)[\"']?\\)/i);\r\n    return matches && matches[1]\r\n}\r\n\r\nfunction setFontStyle(context, options) {\r\n    var fontParams = [];\r\n    options.fontSize = options.fontSize || DEFAULT_FONT_SIZE;\r\n    options.fontFamily = options.fontFamily || DEFAULT_FONT_FAMILY;\r\n    options.fill = options.fill || DEFAULT_TEXT_COLOR;\r\n    options.fontStyle && fontParams.push(options.fontStyle);\r\n    options.fontWeight && fontParams.push(options.fontWeight);\r\n    fontParams.push(options.fontSize);\r\n    fontParams.push(options.fontFamily);\r\n    context.font = fontParams.join(\" \");\r\n    context.textAlign = options.textAlign;\r\n    context.fillStyle = options.fill;\r\n    context.globalAlpha = options.globalAlpha\r\n}\r\n\r\nfunction drawText(context, options, shared) {\r\n    setFontStyle(context, options);\r\n    applyFilter(context, options, shared);\r\n    options.text && context.fillText(options.text, options.x || 0, options.y || 0);\r\n    strokeElement(context, options, true);\r\n    drawTextDecoration(context, options, shared)\r\n}\r\n\r\nfunction drawTextDecoration(context, options, shared) {\r\n    if (!options.textDecoration || \"none\" === options.textDecoration) {\r\n        return\r\n    }\r\n    var x = options.x;\r\n    var textWidth = context.measureText(options.text).width;\r\n    var textHeight = parseInt(options.fontSize, 10);\r\n    var lineHeight = textHeight * TEXT_DECORATION_LINE_WIDTH_COEFF < 1 ? 1 : textHeight * TEXT_DECORATION_LINE_WIDTH_COEFF;\r\n    var y = options.y;\r\n    switch (options.textDecoration) {\r\n        case \"line-through\":\r\n            y -= textHeight / 3 + lineHeight / 2;\r\n            break;\r\n        case \"overline\":\r\n            y -= textHeight - lineHeight;\r\n            break;\r\n        case \"underline\":\r\n            y += lineHeight\r\n    }\r\n    context.rect(x, y, textWidth, lineHeight);\r\n    fillElement(context, options, shared);\r\n    strokeElement(context, options)\r\n}\r\n\r\nfunction aggregateOpacity(options) {\r\n    options.strokeOpacity = void 0 !== options[\"stroke-opacity\"] ? options[\"stroke-opacity\"] : 1;\r\n    options.fillOpacity = void 0 !== options[\"fill-opacity\"] ? options[\"fill-opacity\"] : 1;\r\n    if (void 0 !== options.opacity) {\r\n        options.strokeOpacity *= options.opacity;\r\n        options.fillOpacity *= options.opacity\r\n    }\r\n}\r\n\r\nfunction hasTspan(element) {\r\n    var nodes = element.childNodes;\r\n    for (var i = 0; i < nodes.length; i++) {\r\n        if (\"tspan\" === nodes[i].tagName) {\r\n            return true\r\n        }\r\n    }\r\n    return false\r\n}\r\n\r\nfunction drawTextElement(childNodes, context, options, shared) {\r\n    var lines = [];\r\n    var line;\r\n    var offset = 0;\r\n    for (var i = 0; i < childNodes.length; i++) {\r\n        var element = childNodes[i];\r\n        if (void 0 === element.tagName) {\r\n            drawElement(element, context, options, shared)\r\n        } else if (\"tspan\" === element.tagName || \"text\" === element.tagName) {\r\n            var elementOptions = getElementOptions(element, shared.rootAppended);\r\n            var mergedOptions = extend({}, options, elementOptions);\r\n            if (\"tspan\" === element.tagName && hasTspan(element)) {\r\n                drawTextElement(element.childNodes, context, mergedOptions, shared);\r\n                continue\r\n            }\r\n            mergedOptions.textAlign = \"start\";\r\n            if (!line || void 0 !== elementOptions.x) {\r\n                line = {\r\n                    elements: [],\r\n                    options: [],\r\n                    widths: [],\r\n                    offsets: []\r\n                };\r\n                lines.push(line)\r\n            }\r\n            if (void 0 !== elementOptions.y) {\r\n                offset = 0\r\n            }\r\n            if (void 0 !== elementOptions.dy) {\r\n                offset += parseFloat(elementOptions.dy)\r\n            }\r\n            line.elements.push(element);\r\n            line.options.push(mergedOptions);\r\n            line.offsets.push(offset);\r\n            setFontStyle(context, mergedOptions);\r\n            line.widths.push(context.measureText(mergedOptions.text).width)\r\n        }\r\n    }\r\n    lines.forEach((function(line) {\r\n        var commonWidth = line.widths.reduce((function(commonWidth, width) {\r\n            return commonWidth + width\r\n        }), 0);\r\n        var xDiff = 0;\r\n        var currentOffset = 0;\r\n        if (\"center\" === options.textAlign) {\r\n            xDiff = commonWidth / 2\r\n        }\r\n        if (\"end\" === options.textAlign) {\r\n            xDiff = commonWidth\r\n        }\r\n        line.options.forEach((function(o, index) {\r\n            var width = line.widths[index];\r\n            o.x = o.x - xDiff + currentOffset;\r\n            o.y += line.offsets[index];\r\n            currentOffset += width\r\n        }));\r\n        line.elements.forEach((function(element, index) {\r\n            drawTextElement(element.childNodes, context, line.options[index], shared)\r\n        }))\r\n    }))\r\n}\r\n\r\nfunction drawElement(element, context, parentOptions, shared) {\r\n    var tagName = element.tagName;\r\n    var isText = \"text\" === tagName || \"tspan\" === tagName || void 0 === tagName;\r\n    var isImage = \"image\" === tagName;\r\n    var options = extend({}, parentOptions, getElementOptions(element, shared.rootAppended));\r\n    if (\"hidden\" === options.visibility || options[HIDDEN_FOR_EXPORT]) {\r\n        return\r\n    }\r\n    context.save();\r\n    !isImage && transformElement(context, options);\r\n    clipElement(context, options, shared);\r\n    aggregateOpacity(options);\r\n    var promise;\r\n    context.beginPath();\r\n    switch (element.tagName) {\r\n        case void 0:\r\n            drawText(context, options, shared);\r\n            break;\r\n        case \"text\":\r\n        case \"tspan\":\r\n            drawTextElement(element.childNodes, context, options, shared);\r\n            break;\r\n        case \"image\":\r\n            promise = drawImage(context, options, shared);\r\n            break;\r\n        case \"path\":\r\n            drawPath(context, options.d);\r\n            break;\r\n        case \"rect\":\r\n            drawRect(context, options);\r\n            context.closePath();\r\n            break;\r\n        case \"circle\":\r\n            context.arc(options.cx, options.cy, options.r, 0, 2 * PI, 1)\r\n    }\r\n    if (!isText) {\r\n        applyFilter(context, options, shared);\r\n        fillElement(context, options, shared);\r\n        strokeElement(context, options)\r\n    }\r\n    applyGradient(context, options, shared, element);\r\n    context.restore();\r\n    return promise\r\n}\r\n\r\nfunction applyGradient(context, options, _ref, element) {\r\n    var {\r\n        gradients: gradients\r\n    } = _ref;\r\n    if (0 === gradients.length) {\r\n        return\r\n    }\r\n    var id = parseUrl(options.fill);\r\n    if (id && gradients[id]) {\r\n        var box = element.getBBox();\r\n        var gradient = context.createLinearGradient(box.x, 0, box.x + box.width, 0);\r\n        gradients[id].forEach(opt => {\r\n            var offset = parseInt(opt.offset.replace(/%/, \"\"));\r\n            gradient.addColorStop(offset / 100, opt.stopColor)\r\n        });\r\n        context.globalAlpha = options.opacity;\r\n        context.fillStyle = gradient;\r\n        context.fill()\r\n    }\r\n}\r\n\r\nfunction applyFilter(context, options, shared) {\r\n    var filterOptions;\r\n    var id = parseUrl(options.filter);\r\n    if (id) {\r\n        filterOptions = shared.filters[id];\r\n        if (!filterOptions) {\r\n            filterOptions = {\r\n                offsetX: 0,\r\n                offsetY: 0,\r\n                blur: 0,\r\n                color: \"#000\"\r\n            }\r\n        }\r\n        context.shadowOffsetX = filterOptions.offsetX;\r\n        context.shadowOffsetY = filterOptions.offsetY;\r\n        context.shadowColor = filterOptions.color;\r\n        context.shadowBlur = filterOptions.blur\r\n    }\r\n}\r\n\r\nfunction transformElement(context, options) {\r\n    context.translate(options.translateX || 0, options.translateY || 0);\r\n    options.translateX = void 0;\r\n    options.translateY = void 0;\r\n    if (options.rotationAngle) {\r\n        context.translate(options.rotationX || 0, options.rotationY || 0);\r\n        context.rotate(options.rotationAngle * PI / 180);\r\n        context.translate(-(options.rotationX || 0), -(options.rotationY || 0));\r\n        options.rotationAngle = void 0;\r\n        options.rotationX = void 0;\r\n        options.rotationY = void 0\r\n    }\r\n    if (isFinite(options.scaleX)) {\r\n        context.scale(options.scaleX, options.scaleY);\r\n        options.scaleX = void 0;\r\n        options.scaleY = void 0\r\n    }\r\n}\r\n\r\nfunction clipElement(context, options, shared) {\r\n    if (options[\"clip-path\"]) {\r\n        drawElement(shared.clipPaths[parseUrl(options[\"clip-path\"])], context, {}, shared);\r\n        context.clip();\r\n        options[\"clip-path\"] = void 0\r\n    }\r\n}\r\n\r\nfunction hex2rgba(hexColor, alpha) {\r\n    var color = new Color(hexColor);\r\n    return \"rgba(\" + color.r + \",\" + color.g + \",\" + color.b + \",\" + alpha + \")\"\r\n}\r\n\r\nfunction createGradient(element) {\r\n    var options = [];\r\n    _each(element.childNodes, (_, _ref2) => {\r\n        var {\r\n            attributes: attributes\r\n        } = _ref2;\r\n        options.push({\r\n            offset: attributes.offset.value,\r\n            stopColor: attributes[\"stop-color\"].value\r\n        })\r\n    });\r\n    return options\r\n}\r\n\r\nfunction createFilter(element) {\r\n    var color;\r\n    var opacity;\r\n    var filterOptions = {};\r\n    _each(element.childNodes, (function(_, node) {\r\n        var attr = node.attributes;\r\n        if (!attr.result) {\r\n            return\r\n        }\r\n        switch (attr.result.value) {\r\n            case \"gaussianBlurResult\":\r\n                filterOptions.blur = _number(attr.stdDeviation.value);\r\n                break;\r\n            case \"offsetResult\":\r\n                filterOptions.offsetX = _number(attr.dx.value);\r\n                filterOptions.offsetY = _number(attr.dy.value);\r\n                break;\r\n            case \"floodResult\":\r\n                color = attr[\"flood-color\"] ? attr[\"flood-color\"].value : \"#000\";\r\n                opacity = attr[\"flood-opacity\"] ? attr[\"flood-opacity\"].value : 1;\r\n                filterOptions.color = hex2rgba(color, opacity)\r\n        }\r\n    }));\r\n    return filterOptions\r\n}\r\n\r\nfunction asyncEach(array, callback) {\r\n    var d = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : new Deferred;\r\n    var i = 0;\r\n    for (; i < array.length; i++) {\r\n        var result = callback(array[i]);\r\n        if (isPromise(result)) {\r\n            result.then(() => {\r\n                asyncEach(Array.prototype.slice.call(array, i + 1), callback, d)\r\n            });\r\n            break\r\n        }\r\n    }\r\n    if (i === array.length) {\r\n        d.resolve()\r\n    }\r\n    return d\r\n}\r\n\r\nfunction drawCanvasElements(elements, context, parentOptions, shared) {\r\n    return asyncEach(elements, (function(element) {\r\n        switch (element.tagName && element.tagName.toLowerCase()) {\r\n            case \"g\":\r\n            case \"svg\":\r\n                var options = extend({}, parentOptions, getElementOptions(element, shared.rootAppended));\r\n                context.save();\r\n                transformElement(context, options);\r\n                clipElement(context, options, shared);\r\n                var onDone = () => {\r\n                    context.restore()\r\n                };\r\n                var d = drawCanvasElements(element.childNodes, context, options, shared);\r\n                if (isPromise(d)) {\r\n                    d.then(onDone)\r\n                } else {\r\n                    onDone()\r\n                }\r\n                return d;\r\n            case \"defs\":\r\n                return drawCanvasElements(element.childNodes, context, {}, shared);\r\n            case \"clippath\":\r\n                shared.clipPaths[element.attributes.id.textContent] = element.childNodes[0];\r\n                break;\r\n            case \"pattern\":\r\n                shared.patterns[element.attributes.id.textContent] = element;\r\n                break;\r\n            case \"filter\":\r\n                shared.filters[element.id] = createFilter(element);\r\n                break;\r\n            case \"lineargradient\":\r\n                shared.gradients[element.attributes.id.textContent] = createGradient(element);\r\n                break;\r\n            default:\r\n                return drawElement(element, context, parentOptions, shared)\r\n        }\r\n    }))\r\n}\r\n\r\nfunction setLineDash(context, options) {\r\n    var matches = options[\"stroke-dasharray\"] && options[\"stroke-dasharray\"].match(/(\\d+)/g);\r\n    if (matches && matches.length) {\r\n        matches = _map(matches, (function(item) {\r\n            return _number(item)\r\n        }));\r\n        context.setLineDash(matches)\r\n    }\r\n}\r\n\r\nfunction strokeElement(context, options, isText) {\r\n    var stroke = options.stroke;\r\n    if (stroke && \"none\" !== stroke && 0 !== options[\"stroke-width\"]) {\r\n        setLineDash(context, options);\r\n        context.lineJoin = options[\"stroke-linejoin\"];\r\n        context.lineWidth = options[\"stroke-width\"];\r\n        context.globalAlpha = options.strokeOpacity;\r\n        context.strokeStyle = stroke;\r\n        isText ? context.strokeText(options.text, options.x, options.y) : context.stroke();\r\n        context.globalAlpha = 1\r\n    }\r\n}\r\n\r\nfunction getPattern(context, pattern, shared) {\r\n    var options = getElementOptions(pattern, shared.rootAppended);\r\n    var patternCanvas = imageCreator._createCanvas(options.width, options.height, 0);\r\n    var patternContext = patternCanvas.getContext(\"2d\");\r\n    drawCanvasElements(pattern.childNodes, patternContext, options, shared);\r\n    return context.createPattern(patternCanvas, \"repeat\")\r\n}\r\n\r\nfunction fillElement(context, options, shared) {\r\n    var fill = options.fill;\r\n    if (fill && \"none\" !== fill) {\r\n        if (-1 === fill.search(/url/)) {\r\n            context.fillStyle = fill\r\n        } else {\r\n            var pattern = shared.patterns[parseUrl(fill)];\r\n            if (!pattern) {\r\n                return\r\n            }\r\n            context.fillStyle = getPattern(context, pattern, shared)\r\n        }\r\n        context.globalAlpha = options.fillOpacity;\r\n        context.fill();\r\n        context.globalAlpha = 1\r\n    }\r\n}\r\nparseAttributes = function(attributes) {\r\n    var newAttributes = {};\r\n    var attr;\r\n    _each(attributes, (function(index, item) {\r\n        attr = item.textContent;\r\n        if (isFinite(attr)) {\r\n            attr = _number(attr)\r\n        }\r\n        newAttributes[item.name.toLowerCase()] = attr\r\n    }));\r\n    return newAttributes\r\n};\r\n\r\nfunction drawBackground(context, width, height, backgroundColor, margin) {\r\n    context.fillStyle = backgroundColor || \"#ffffff\";\r\n    context.fillRect(-margin, -margin, width + 2 * margin, height + 2 * margin)\r\n}\r\n\r\nfunction createInvisibleDiv() {\r\n    var invisibleDiv = domAdapter.createElement(\"div\");\r\n    invisibleDiv.style.left = \"-9999px\";\r\n    invisibleDiv.style.position = \"absolute\";\r\n    return invisibleDiv\r\n}\r\n\r\nfunction convertSvgToCanvas(svg, canvas, rootAppended) {\r\n    return drawCanvasElements(svg.childNodes, canvas.getContext(\"2d\"), {}, {\r\n        clipPaths: {},\r\n        patterns: {},\r\n        filters: {},\r\n        gradients: {},\r\n        rootAppended: rootAppended\r\n    })\r\n}\r\n\r\nfunction getCanvasFromSvg(markup, _ref3) {\r\n    var {\r\n        width: width,\r\n        height: height,\r\n        backgroundColor: backgroundColor,\r\n        margin: margin,\r\n        svgToCanvas: svgToCanvas = convertSvgToCanvas\r\n    } = _ref3;\r\n    var scaledScreenInfo = calcScaledInfo(width, height);\r\n    var canvas = imageCreator._createCanvas(scaledScreenInfo.width, scaledScreenInfo.height, margin);\r\n    var context = canvas.getContext(\"2d\");\r\n    context.setTransform(scaledScreenInfo.pixelRatio, 0, 0, scaledScreenInfo.pixelRatio, 0, 0);\r\n    var svgElem = getSvgElement(markup);\r\n    var invisibleDiv;\r\n    var markupIsDomElement = domAdapter.isElementNode(markup);\r\n    context.translate(margin, margin);\r\n    domAdapter.getBody().appendChild(canvas);\r\n    if (!markupIsDomElement) {\r\n        invisibleDiv = createInvisibleDiv();\r\n        invisibleDiv.appendChild(svgElem);\r\n        domAdapter.getBody().appendChild(invisibleDiv)\r\n    }\r\n    if (svgElem.attributes.direction) {\r\n        canvas.dir = svgElem.attributes.direction.textContent\r\n    }\r\n    drawBackground(context, width, height, backgroundColor, margin);\r\n    return fromPromise(svgToCanvas(svgElem, canvas, markupIsDomElement && contains(domAdapter.getBody(), markup))).then(() => canvas).always(() => {\r\n        invisibleDiv && domAdapter.getBody().removeChild(invisibleDiv);\r\n        domAdapter.getBody().removeChild(canvas)\r\n    })\r\n}\r\nexport var imageCreator = {\r\n    getImageData: function(markup, options) {\r\n        var mimeType = \"image/\" + options.format;\r\n        if (isFunction(options.__parseAttributesFn)) {\r\n            parseAttributes = options.__parseAttributesFn\r\n        }\r\n        return getCanvasFromSvg(markup, options).then(canvas => getStringFromCanvas(canvas, mimeType))\r\n    },\r\n    getData: function(markup, options) {\r\n        var that = this;\r\n        return imageCreator.getImageData(markup, options).then(binaryData => {\r\n            var mimeType = \"image/\" + options.format;\r\n            var data = isFunction(window.Blob) && !options.forceProxy ? that._getBlob(binaryData, mimeType) : that._getBase64(binaryData);\r\n            return data\r\n        })\r\n    },\r\n    _getBlob: function(binaryData, mimeType) {\r\n        var i;\r\n        var dataArray = new Uint8Array(binaryData.length);\r\n        for (i = 0; i < binaryData.length; i++) {\r\n            dataArray[i] = binaryData.charCodeAt(i)\r\n        }\r\n        return new window.Blob([dataArray.buffer], {\r\n            type: mimeType\r\n        })\r\n    },\r\n    _getBase64: function(binaryData) {\r\n        return window.btoa(binaryData)\r\n    },\r\n    _createCanvas(width, height, margin) {\r\n        var canvas = $(\"<canvas>\")[0];\r\n        canvas.width = width + 2 * margin;\r\n        canvas.height = height + 2 * margin;\r\n        canvas.hidden = true;\r\n        return canvas\r\n    }\r\n};\r\nexport function getData(data, options) {\r\n    return imageCreator.getData(data, options)\r\n}\r\nexport function testFormats(formats) {\r\n    var canvas = imageCreator._createCanvas(100, 100, 0);\r\n    return formats.reduce((function(r, f) {\r\n        var mimeType = (\"image/\" + f).toLowerCase();\r\n        if (-1 !== canvas.toDataURL(mimeType).indexOf(mimeType)) {\r\n            r.supported.push(f)\r\n        } else {\r\n            r.unsupported.push(f)\r\n        }\r\n        return r\r\n    }), {\r\n        supported: [],\r\n        unsupported: []\r\n    })\r\n}\r\nexport function calcScaledInfo(width, height) {\r\n    var pixelRatio = window.devicePixelRatio || 1;\r\n    return {\r\n        pixelRatio: pixelRatio,\r\n        width: width * pixelRatio,\r\n        height: height * pixelRatio\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}